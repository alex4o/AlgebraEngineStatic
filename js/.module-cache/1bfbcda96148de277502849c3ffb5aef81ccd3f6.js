
/*
var data = {
	fraction    : 50,
	natural		: 50,
	irrational	: 0,
	up	: {low:1 ,high:10},
	down: {low:1 ,high:10}
}
*/
var model = {
	view_id: 0,
	data: {

	},
	addres: "",
	user: {
		name: "",
		pass: ""
	},
	res :{

	}
}

function checkStorageForDataOrReturnDefault(def){
	if(localStorage[model.addres] != null && localStorage[model.addres] != ""){
		return JSON.parse(localStorage[model.addres]);
	}else{
		return def
	}
}

/** @jsx React.DOM */
var MathComponent = React.createClass({displayName: "MathComponent",
	componentDidUpdate:function(prevProps, prevState){

		var problem = this.refs.problem.getDOMNode()
		var solution = this.refs.solution.getDOMNode()
		katex.render(this.props.math[0].problem,problem)
		katex.render(this.props.math[0].solution,solution)
		
	},
	componentDidMount: function() {
		this.refs.problem.getDOMNode().innerHTML = "За да създадете задача натиснете генерирай"
	},
	render: function(){
		return (
			React.createElement("div", {id: "MathContainer"}, 
				React.createElement("span", {id: "result", ref: "problem"}), 
				React.createElement("span", {style: {display:this.props.solutionVisable ? "block" : "none"}, ref: "solution"})
			))
	}
})


var InputComponent = React.createClass({displayName: "InputComponent",
	views: [EquivalentExpressions,Equation,QuadraticEquation],
	getInitialState: function(){
		return {view: "div"}
	},
	componentDidMount: function(){
		console.log(this.views)
		routie('problems/type/:id', this.changeView);
	},
	changeView: function(id){
		if(id < this.views.length){
			this.setState({view: this.views[id]})
			model.view_id = id | 0;
		}
	},
	render: function () {
		var data = this.props.model.data
		return (React.createElement(this.state.view,{model:model}));
	}
});

var KaТeXitem = React.createClass({displayName: "KaТeXitem",
	componentDidMount:  function(){

		//console.log(this.props.problem)

		var shit = this.refs.shit.getDOMNode()
		katex.render(this.props.problem,shit)


	},
	componentDidUpdate: function(prevProps, prevState){
		//console.log(this.props.problem)

		var shit = this.refs.shit.getDOMNode()
		katex.render(this.props.problem,shit)
	},
	render: function(){
		return(React.createElement("span", {ref: "shit"}))
	}
})

var PrintListComponent = React.createClass({displayName: "PrintListComponent",
	componentDidUpdate: function(){
		
	},
	render: function () {
		problems = this.props.res.map(function(result,iter){
			//console.log(result)
			return (React.createElement("div", {className: "items"}, React.createElement("span", {className: "num"}, iter+1), React.createElement(KaТeXitem, {problem: result.problem})))
		})

		solution = this.props.res.map(function(result,iter){
			//console.log(result)
			return (React.createElement("div", {className: "items"}, React.createElement("span", {className: "num"}, iter+1), React.createElement(KaТeXitem, {problem: result.solution})))
		})
		var st = {}
		if(this.props.res.length > 0){
			st["display"] = "block"
			ofset = document.getElementById("anchor").offsetTop;
			scrollTo(0,ofset)

		}else{
			st["display"] = "none"
		}

		return (

			React.createElement("div", {id: "anchor", style: st, className: "list"}, 
				"Задачи:", 
				problems, 
				React.createElement("br", null), 
				"Отговори:", 
				problems
			)
		)
	}
});


var MenuList = React.createClass({displayName: "MenuList",
	getInitialState: function () {
		return {
			selected: model.view_id
		};
	},
	change: function(index){
		console.log(index)
		this.setState({selected: index})
	},
	render: function(){
		var self = this;
		var list = this.props.items.map(function(item,index){
			var style = ""
			if(self.state.selected == index){
				style = "selected"
			}
			return React.createElement("a", {className: style, href: item.href, onClick: self.change.bind(self,index)}, item.text)
		})
		return (React.createElement("div", null, list))
	}
}) 

var ViewChanger = React.createClass({displayName: "ViewChanger",

	render: function () {
		console.log(this.props)
		if(this.props.id < this.props.views.length){
			return (React.createElement(this.props.views[this.props.id],{model:model}));
		}else{
			return React.createElement("div", null)
		}
	}
});


var Generator = React.createClass({displayName: "Generator",
	getInitialState: function(){
		return {
			math: [{problem: "", solution: ""}],
			sv: false,
			list: []
		}
	},
	submit: function(){
		self = this
		localStorage[model.addres] = JSON.stringify(model.data)
		superagent.post("/api" + model.addres).send(model.data).send({cor:1}).end(function(res){
			if(res.status == 200){
				model.res = JSON.parse(res.text)
				self.setState({math: model.res})

			}else{
				self.setState({math: {problem: "error",solution:" --- "} })

				//katex.render("error",problem)


			}
		});
		//alert(math)
		//console.log(math)
		
		//this.setState({math: math})
	},
	submit_more: function(){
		self = this
		localStorage[model.addres] = JSON.stringify(model.data)
		
		
		superagent.post("/api" + model.addres).send(model.data).send({cor:10}).end(function(res){
			if(res.status == 200){
				model.res = JSON.parse(res.text)
				console.log(model.res)

				self.setState({list: model.res})
				console.log(ofset)

			}else{
				//katex.render("error",problem)


			}
		});


		//alert(math)
		//console.log(math)
	},
	show: function(){
		this.setState({sv: !this.state.sv});
	},
	render: function () {
		return (
			React.createElement("div", null, 

			React.createElement(MathComponent, {math: this.state.math, solutionVisable: this.state.sv}), 

			React.createElement("div", {id: "sidebar"}, 
					React.createElement("div", {className: "item"}, 
						React.createElement("span", null, "7 клас"), 
						React.createElement(MenuList, {items: [
							{href: "#problems/type/0", text:"Tъждествени изрази"},
							{href: "#problems/type/1", text:"Уравнения"}
							]})
					)
			), 

			React.createElement("div", {id: "inner-content"}, 
				
				React.createElement("div", null, 
					React.createElement("div", {className: "menu"}, 
						React.createElement("div", {className: "menu-item", onClick: this.submit}, "Генерирай"), 
						React.createElement("div", {className: "menu-item", onClick: this.submit_more}, "Генерирай няколко"), 
						React.createElement("div", {className: "menu-item", onClick: this.show}, "Покажи/скрий отговорите")
					), 
					
					React.createElement("div", {id: "InputContainer"}, 
						React.createElement(InputComponent, {model: model})
					), 

					React.createElement(PrintListComponent, {res: this.state.list})

				)
			)

			)

		);
	}
});

var Menu = React.createClass({displayName: "Menu",
	getInitialState: function() {
		return {
			visible: false	
		};
	},

	show: function() {
		this.setState({ visible: true });
		document.addEventListener("click", this.hide.bind(this));
	},

	hide: function() {
		document.removeEventListener("click", this.hide.bind(this));
		this.setState({ visible: false });
	},

	render: function() {
		return (
		React.createElement("div", {className: ""}, 
			React.createElement("div", {className: "slide-menu-"+(this.state.visible ? "visible " : "")+ " slide-menu"}, 
				this.props.children
			)
		));
	}
});

var MenuItem = React.createClass({displayName: "MenuItem",
	navigate: function(hash) {
		window.location.hash = hash;
	},

	render: function() {
		return React.createElement("div", {className: "slide-menu-item", onClick: this.navigate.bind(this, this.props.hash)}, this.props.children);
	}
});

var App = React.createClass({displayName: "App",
	getInitialState: function(){
		return {
			page: 0
		}
	},
	render: function () {
		return (
			React.createElement("div", null, 
				React.createElement(Menu, null, 
					React.createElement(MenuItem, {hash: "#WTF"}, "Hello"), 
					React.createElement(MenuItem, {hash: "#WTF1"}, "NoWay"), 
					React.createElement(MenuItem, {hash: "#WTF2"}, "Shit")

				), 
				React.createElement(ViewChanger, {views: [Generator], id: this.state.page})

			)
		);
	}
});

React.render(React.createElement(App, null),document.getElementById("content"))
React.render(React.createElement(UserForm, {data: model.user}),document.getElementById("user"))



//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJhbnNmb3JtZWQuanMiLCJzb3VyY2VzIjpbbnVsbF0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0VBRUU7QUFDRixJQUFJLEtBQUssR0FBRztDQUNYLE9BQU8sRUFBRSxDQUFDO0FBQ1gsQ0FBQyxJQUFJLEVBQUU7O0VBRUw7Q0FDRCxNQUFNLEVBQUUsRUFBRTtDQUNWLElBQUksRUFBRTtFQUNMLElBQUksRUFBRSxFQUFFO0VBQ1IsSUFBSSxFQUFFLEVBQUU7RUFDUjtBQUNGLENBQUMsR0FBRyxFQUFFOztFQUVKO0FBQ0YsQ0FBQzs7QUFFRCxTQUFTLGtDQUFrQyxDQUFDLEdBQUcsQ0FBQztDQUMvQyxHQUFHLFlBQVksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLElBQUksSUFBSSxJQUFJLFlBQVksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLElBQUksRUFBRSxDQUFDO0VBQ3pFLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxZQUFZLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7RUFDOUMsSUFBSTtFQUNKLE9BQU8sR0FBRztFQUNWO0FBQ0YsQ0FBQzs7QUFFRCxxQkFBcUI7QUFDckIsSUFBSSxtQ0FBbUMsNkJBQUE7QUFDdkMsQ0FBQyxrQkFBa0IsQ0FBQyxTQUFTLFNBQVMsRUFBRSxTQUFTLENBQUM7O0VBRWhELElBQUksT0FBTyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLFVBQVUsRUFBRTtFQUM1QyxJQUFJLFFBQVEsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxVQUFVLEVBQUU7RUFDOUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDO0FBQ2xELEVBQUUsS0FBSyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFD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QyxRQUFRLEVBQUEsQ0FBQSxDQUFDLElBQUEsRUFBSSxDQUFFLEtBQUssQ0FBQyxJQUFLLENBQUUsQ0FBQSxDQUFDLFFBQVEsQ0FBQyxjQUFjLENBQUMsTUFBTSxDQUFDLENBQUM7QUFDM0UiLCJzb3VyY2VzQ29udGVudCI6WyJcbi8qXG52YXIgZGF0YSA9IHtcblx0ZnJhY3Rpb24gICAgOiA1MCxcblx0bmF0dXJhbFx0XHQ6IDUwLFxuXHRpcnJhdGlvbmFsXHQ6IDAsXG5cdHVwXHQ6IHtsb3c6MSAsaGlnaDoxMH0sXG5cdGRvd246IHtsb3c6MSAsaGlnaDoxMH1cbn1cbiovXG52YXIgbW9kZWwgPSB7XG5cdHZpZXdfaWQ6IDAsXG5cdGRhdGE6IHtcblxuXHR9LFxuXHRhZGRyZXM6IFwiXCIsXG5cdHVzZXI6IHtcblx0XHRuYW1lOiBcIlwiLFxuXHRcdHBhc3M6IFwiXCJcblx0fSxcblx0cmVzIDp7XG5cblx0fVxufVxuXG5mdW5jdGlvbiBjaGVja1N0b3JhZ2VGb3JEYXRhT3JSZXR1cm5EZWZhdWx0KGRlZil7XG5cdGlmKGxvY2FsU3RvcmFnZVttb2RlbC5hZGRyZXNdICE9IG51bGwgJiYgbG9jYWxTdG9yYWdlW21vZGVsLmFkZHJlc10gIT0gXCJcIil7XG5cdFx0cmV0dXJuIEpTT04ucGFyc2UobG9jYWxTdG9yYWdlW21vZGVsLmFkZHJlc10pO1xuXHR9ZWxzZXtcblx0XHRyZXR1cm4gZGVmXG5cdH1cbn1cblxuLyoqIEBqc3ggUmVhY3QuRE9NICovXG52YXIgTWF0aENvbXBvbmVudCA9IFJlYWN0LmNyZWF0ZUNsYXNzKHtcblx0Y29tcG9uZW50RGlkVXBkYXRlOmZ1bmN0aW9uKHByZXZQcm9wcywgcHJldlN0YXRlKXtcblxuXHRcdHZhciBwcm9ibGVtID0gdGhpcy5yZWZzLnByb2JsZW0uZ2V0RE9NTm9kZSgpXG5cdFx0dmFyIHNvbHV0aW9uID0gdGhpcy5yZWZzLnNvbHV0aW9uLmdldERPTU5vZGUoKVxuXHRcdGthdGV4LnJlbmRlcih0aGlzLnByb3BzLm1hdGhbMF0ucHJvYmxlbSxwcm9ibGVtKVxuXHRcdGthdGV4LnJlbmRlcih0aGlzLnByb3BzLm1hdGhbMF0uc29sdXRpb24sc29sdXRpb24pXG5cdFx0XG5cdH0sXG5cdGNvbXBvbmVudERpZE1vdW50OiBmdW5jdGlvbigpIHtcblx0XHR0aGlzLnJlZnMucHJvYmxlbS5nZXRET01Ob2RlKCkuaW5uZXJIVE1MID0gXCLQl9CwINC00LAg0YHRitC30LTQsNC00LXRgtC1INC30LDQtNCw0YfQsCDQvdCw0YLQuNGB0L3QtdGC0LUg0LPQtdC90LXRgNC40YDQsNC5XCJcblx0fSxcblx0cmVuZGVyOiBmdW5jdGlvbigpe1xuXHRcdHJldHVybiAoXG5cdFx0XHQ8ZGl2IGlkPVwiTWF0aENvbnRhaW5lclwiPlxuXHRcdFx0XHQ8c3BhbiBpZD1cInJlc3VsdFwiIHJlZj1cInByb2JsZW1cIj48L3NwYW4+XG5cdFx0XHRcdDxzcGFuIHN0eWxlPXt7ZGlzcGxheTp0aGlzLnByb3BzLnNvbHV0aW9uVmlzYWJsZSA/IFwiYmxvY2tcIiA6IFwibm9uZVwifX0gcmVmPVwic29sdXRpb25cIj48L3NwYW4+XG5cdFx0XHQ8L2Rpdj4pXG5cdH1cbn0pXG5cblxudmFyIElucHV0Q29tcG9uZW50ID0gUmVhY3QuY3JlYXRlQ2xhc3Moe1xuXHR2aWV3czogW0VxdWl2YWxlbnRFeHByZXNzaW9ucyxFcXVhdGlvbixRdWFkcmF0aWNFcXVhdGlvbl0sXG5cdGdldEluaXRpYWxTdGF0ZTogZnVuY3Rpb24oKXtcblx0XHRyZXR1cm4ge3ZpZXc6IFwiZGl2XCJ9XG5cdH0sXG5cdGNvbXBvbmVudERpZE1vdW50OiBmdW5jdGlvbigpe1xuXHRcdGNvbnNvbGUubG9nKHRoaXMudmlld3MpXG5cdFx0cm91dGllKCdwcm9ibGVtcy90eXBlLzppZCcsIHRoaXMuY2hhbmdlVmlldyk7XG5cdH0sXG5cdGNoYW5nZVZpZXc6IGZ1bmN0aW9uKGlkKXtcblx0XHRpZihpZCA8IHRoaXMudmlld3MubGVuZ3RoKXtcblx0XHRcdHRoaXMuc2V0U3RhdGUoe3ZpZXc6IHRoaXMudmlld3NbaWRdfSlcblx0XHRcdG1vZGVsLnZpZXdfaWQgPSBpZCB8IDA7XG5cdFx0fVxuXHR9LFxuXHRyZW5kZXI6IGZ1bmN0aW9uICgpIHtcblx0XHR2YXIgZGF0YSA9IHRoaXMucHJvcHMubW9kZWwuZGF0YVxuXHRcdHJldHVybiAoUmVhY3QuY3JlYXRlRWxlbWVudCh0aGlzLnN0YXRlLnZpZXcse21vZGVsOm1vZGVsfSkpO1xuXHR9XG59KTtcblxudmFyIEth0KJlWGl0ZW0gPSBSZWFjdC5jcmVhdGVDbGFzcyh7XG5cdGNvbXBvbmVudERpZE1vdW50OiAgZnVuY3Rpb24oKXtcblxuXHRcdC8vY29uc29sZS5sb2codGhpcy5wcm9wcy5wcm9ibGVtKVxuXG5cdFx0dmFyIHNoaXQgPSB0aGlzLnJlZnMuc2hpdC5nZXRET01Ob2RlKClcblx0XHRrYXRleC5yZW5kZXIodGhpcy5wcm9wcy5wcm9ibGVtLHNoaXQpXG5cblxuXHR9LFxuXHRjb21wb25lbnREaWRVcGRhdGU6IGZ1bmN0aW9uKHByZXZQcm9wcywgcHJldlN0YXRlKXtcblx0XHQvL2NvbnNvbGUubG9nKHRoaXMucHJvcHMucHJvYmxlbSlcblxuXHRcdHZhciBzaGl0ID0gdGhpcy5yZWZzLnNoaXQuZ2V0RE9NTm9kZSgpXG5cdFx0a2F0ZXgucmVuZGVyKHRoaXMucHJvcHMucHJvYmxlbSxzaGl0KVxuXHR9LFxuXHRyZW5kZXI6IGZ1bmN0aW9uKCl7XG5cdFx0cmV0dXJuKDxzcGFuICByZWY9XCJzaGl0XCI+PC9zcGFuPilcblx0fVxufSlcblxudmFyIFByaW50TGlzdENvbXBvbmVudCA9IFJlYWN0LmNyZWF0ZUNsYXNzKHtcblx0Y29tcG9uZW50RGlkVXBkYXRlOiBmdW5jdGlvbigpe1xuXHRcdFxuXHR9LFxuXHRyZW5kZXI6IGZ1bmN0aW9uICgpIHtcblx0XHRwcm9ibGVtcyA9IHRoaXMucHJvcHMucmVzLm1hcChmdW5jdGlvbihyZXN1bHQsaXRlcil7XG5cdFx0XHQvL2NvbnNvbGUubG9nKHJlc3VsdClcblx0XHRcdHJldHVybiAoPGRpdiBjbGFzc05hbWU9XCJpdGVtc1wiPjxzcGFuIGNsYXNzTmFtZT1cIm51bVwiPntpdGVyKzF9PC9zcGFuPjxLYdCiZVhpdGVtIHByb2JsZW09e3Jlc3VsdC5wcm9ibGVtfSAvPjwvZGl2Pilcblx0XHR9KVxuXG5cdFx0c29sdXRpb24gPSB0aGlzLnByb3BzLnJlcy5tYXAoZnVuY3Rpb24ocmVzdWx0LGl0ZXIpe1xuXHRcdFx0Ly9jb25zb2xlLmxvZyhyZXN1bHQpXG5cdFx0XHRyZXR1cm4gKDxkaXYgY2xhc3NOYW1lPVwiaXRlbXNcIj48c3BhbiBjbGFzc05hbWU9XCJudW1cIj57aXRlcisxfTwvc3Bhbj48S2HQomVYaXRlbSBwcm9ibGVtPXtyZXN1bHQuc29sdXRpb259IC8+PC9kaXY+KVxuXHRcdH0pXG5cdFx0dmFyIHN0ID0ge31cblx0XHRpZih0aGlzLnByb3BzLnJlcy5sZW5ndGggPiAwKXtcblx0XHRcdHN0W1wiZGlzcGxheVwiXSA9IFwiYmxvY2tcIlxuXHRcdFx0b2ZzZXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImFuY2hvclwiKS5vZmZzZXRUb3A7XG5cdFx0XHRzY3JvbGxUbygwLG9mc2V0KVxuXG5cdFx0fWVsc2V7XG5cdFx0XHRzdFtcImRpc3BsYXlcIl0gPSBcIm5vbmVcIlxuXHRcdH1cblxuXHRcdHJldHVybiAoXG5cblx0XHRcdDxkaXYgaWQ9XCJhbmNob3JcIiBzdHlsZT17c3R9IGNsYXNzTmFtZT1cImxpc3RcIj5cblx0XHRcdFx00JfQsNC00LDRh9C4OlxuXHRcdFx0XHR7cHJvYmxlbXN9XG5cdFx0XHRcdDxiciAvPlxuXHRcdFx0XHTQntGC0LPQvtCy0L7RgNC4OlxuXHRcdFx0XHR7cHJvYmxlbXN9XG5cdFx0XHQ8L2Rpdj5cblx0XHQpXG5cdH1cbn0pO1xuXG5cbnZhciBNZW51TGlzdCA9IFJlYWN0LmNyZWF0ZUNsYXNzKHtcblx0Z2V0SW5pdGlhbFN0YXRlOiBmdW5jdGlvbiAoKSB7XG5cdFx0cmV0dXJuIHtcblx0XHRcdHNlbGVjdGVkOiBtb2RlbC52aWV3X2lkXG5cdFx0fTtcblx0fSxcblx0Y2hhbmdlOiBmdW5jdGlvbihpbmRleCl7XG5cdFx0Y29uc29sZS5sb2coaW5kZXgpXG5cdFx0dGhpcy5zZXRTdGF0ZSh7c2VsZWN0ZWQ6IGluZGV4fSlcblx0fSxcblx0cmVuZGVyOiBmdW5jdGlvbigpe1xuXHRcdHZhciBzZWxmID0gdGhpcztcblx0XHR2YXIgbGlzdCA9IHRoaXMucHJvcHMuaXRlbXMubWFwKGZ1bmN0aW9uKGl0ZW0saW5kZXgpe1xuXHRcdFx0dmFyIHN0eWxlID0gXCJcIlxuXHRcdFx0aWYoc2VsZi5zdGF0ZS5zZWxlY3RlZCA9PSBpbmRleCl7XG5cdFx0XHRcdHN0eWxlID0gXCJzZWxlY3RlZFwiXG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gPGEgY2xhc3NOYW1lPXtzdHlsZX0gaHJlZj17aXRlbS5ocmVmfSBvbkNsaWNrPXtzZWxmLmNoYW5nZS5iaW5kKHNlbGYsaW5kZXgpfT57aXRlbS50ZXh0fTwvYT5cblx0XHR9KVxuXHRcdHJldHVybiAoPGRpdj57bGlzdH08L2Rpdj4pXG5cdH1cbn0pIFxuXG52YXIgVmlld0NoYW5nZXIgPSBSZWFjdC5jcmVhdGVDbGFzcyh7XG5cblx0cmVuZGVyOiBmdW5jdGlvbiAoKSB7XG5cdFx0Y29uc29sZS5sb2codGhpcy5wcm9wcylcblx0XHRpZih0aGlzLnByb3BzLmlkIDwgdGhpcy5wcm9wcy52aWV3cy5sZW5ndGgpe1xuXHRcdFx0cmV0dXJuIChSZWFjdC5jcmVhdGVFbGVtZW50KHRoaXMucHJvcHMudmlld3NbdGhpcy5wcm9wcy5pZF0se21vZGVsOm1vZGVsfSkpO1xuXHRcdH1lbHNle1xuXHRcdFx0cmV0dXJuIDxkaXY+PC9kaXY+XG5cdFx0fVxuXHR9XG59KTtcblxuXG52YXIgR2VuZXJhdG9yID0gUmVhY3QuY3JlYXRlQ2xhc3Moe1xuXHRnZXRJbml0aWFsU3RhdGU6IGZ1bmN0aW9uKCl7XG5cdFx0cmV0dXJuIHtcblx0XHRcdG1hdGg6IFt7cHJvYmxlbTogXCJcIiwgc29sdXRpb246IFwiXCJ9XSxcblx0XHRcdHN2OiBmYWxzZSxcblx0XHRcdGxpc3Q6IFtdXG5cdFx0fVxuXHR9LFxuXHRzdWJtaXQ6IGZ1bmN0aW9uKCl7XG5cdFx0c2VsZiA9IHRoaXNcblx0XHRsb2NhbFN0b3JhZ2VbbW9kZWwuYWRkcmVzXSA9IEpTT04uc3RyaW5naWZ5KG1vZGVsLmRhdGEpXG5cdFx0c3VwZXJhZ2VudC5wb3N0KFwiL2FwaVwiICsgbW9kZWwuYWRkcmVzKS5zZW5kKG1vZGVsLmRhdGEpLnNlbmQoe2NvcjoxfSkuZW5kKGZ1bmN0aW9uKHJlcyl7XG5cdFx0XHRpZihyZXMuc3RhdHVzID09IDIwMCl7XG5cdFx0XHRcdG1vZGVsLnJlcyA9IEpTT04ucGFyc2UocmVzLnRleHQpXG5cdFx0XHRcdHNlbGYuc2V0U3RhdGUoe21hdGg6IG1vZGVsLnJlc30pXG5cblx0XHRcdH1lbHNle1xuXHRcdFx0XHRzZWxmLnNldFN0YXRlKHttYXRoOiB7cHJvYmxlbTogXCJlcnJvclwiLHNvbHV0aW9uOlwiIC0tLSBcIn0gfSlcblxuXHRcdFx0XHQvL2thdGV4LnJlbmRlcihcImVycm9yXCIscHJvYmxlbSlcblxuXG5cdFx0XHR9XG5cdFx0fSk7XG5cdFx0Ly9hbGVydChtYXRoKVxuXHRcdC8vY29uc29sZS5sb2cobWF0aClcblx0XHRcblx0XHQvL3RoaXMuc2V0U3RhdGUoe21hdGg6IG1hdGh9KVxuXHR9LFxuXHRzdWJtaXRfbW9yZTogZnVuY3Rpb24oKXtcblx0XHRzZWxmID0gdGhpc1xuXHRcdGxvY2FsU3RvcmFnZVttb2RlbC5hZGRyZXNdID0gSlNPTi5zdHJpbmdpZnkobW9kZWwuZGF0YSlcblx0XHRcblx0XHRcblx0XHRzdXBlcmFnZW50LnBvc3QoXCIvYXBpXCIgKyBtb2RlbC5hZGRyZXMpLnNlbmQobW9kZWwuZGF0YSkuc2VuZCh7Y29yOjEwfSkuZW5kKGZ1bmN0aW9uKHJlcyl7XG5cdFx0XHRpZihyZXMuc3RhdHVzID09IDIwMCl7XG5cdFx0XHRcdG1vZGVsLnJlcyA9IEpTT04ucGFyc2UocmVzLnRleHQpXG5cdFx0XHRcdGNvbnNvbGUubG9nKG1vZGVsLnJlcylcblxuXHRcdFx0XHRzZWxmLnNldFN0YXRlKHtsaXN0OiBtb2RlbC5yZXN9KVxuXHRcdFx0XHRjb25zb2xlLmxvZyhvZnNldClcblxuXHRcdFx0fWVsc2V7XG5cdFx0XHRcdC8va2F0ZXgucmVuZGVyKFwiZXJyb3JcIixwcm9ibGVtKVxuXG5cblx0XHRcdH1cblx0XHR9KTtcblxuXG5cdFx0Ly9hbGVydChtYXRoKVxuXHRcdC8vY29uc29sZS5sb2cobWF0aClcblx0fSxcblx0c2hvdzogZnVuY3Rpb24oKXtcblx0XHR0aGlzLnNldFN0YXRlKHtzdjogIXRoaXMuc3RhdGUuc3Z9KTtcblx0fSxcblx0cmVuZGVyOiBmdW5jdGlvbiAoKSB7XG5cdFx0cmV0dXJuIChcblx0XHRcdDxkaXY+XG5cblx0XHRcdDxNYXRoQ29tcG9uZW50IG1hdGg9e3RoaXMuc3RhdGUubWF0aH0gc29sdXRpb25WaXNhYmxlPXt0aGlzLnN0YXRlLnN2fS8+XG5cblx0XHRcdDxkaXYgaWQ9XCJzaWRlYmFyXCI+XG5cdFx0XHRcdFx0PGRpdiBjbGFzc05hbWU9XCJpdGVtXCI+XG5cdFx0XHRcdFx0XHQ8c3Bhbj43INC60LvQsNGBPC9zcGFuPlxuXHRcdFx0XHRcdFx0PE1lbnVMaXN0IGl0ZW1zPXtbXG5cdFx0XHRcdFx0XHRcdHtocmVmOiBcIiNwcm9ibGVtcy90eXBlLzBcIiwgdGV4dDpcIlTRitC20LTQtdGB0YLQstC10L3QuCDQuNC30YDQsNC30LhcIn0sXG5cdFx0XHRcdFx0XHRcdHtocmVmOiBcIiNwcm9ibGVtcy90eXBlLzFcIiwgdGV4dDpcItCj0YDQsNCy0L3QtdC90LjRj1wifVxuXHRcdFx0XHRcdFx0XHRdfSAvPlxuXHRcdFx0XHRcdDwvZGl2PlxuXHRcdFx0PC9kaXY+XG5cblx0XHRcdDxkaXYgaWQ9XCJpbm5lci1jb250ZW50XCIgPlxuXHRcdFx0XHRcblx0XHRcdFx0PGRpdj5cblx0XHRcdFx0XHQ8ZGl2IGNsYXNzTmFtZT1cIm1lbnVcIj5cblx0XHRcdFx0XHRcdDxkaXYgY2xhc3NOYW1lPVwibWVudS1pdGVtXCIgb25DbGljaz17dGhpcy5zdWJtaXR9PtCT0LXQvdC10YDQuNGA0LDQuTwvZGl2PlxuXHRcdFx0XHRcdFx0PGRpdiBjbGFzc05hbWU9XCJtZW51LWl0ZW1cIiBvbkNsaWNrPXt0aGlzLnN1Ym1pdF9tb3JlfT7Qk9C10L3QtdGA0LjRgNCw0Lkg0L3Rj9C60L7Qu9C60L48L2Rpdj5cblx0XHRcdFx0XHRcdDxkaXYgY2xhc3NOYW1lPVwibWVudS1pdGVtXCIgb25DbGljaz17dGhpcy5zaG93fT7Qn9C+0LrQsNC20Lgv0YHQutGA0LjQuSDQvtGC0LPQvtCy0L7RgNC40YLQtTwvZGl2PlxuXHRcdFx0XHRcdDwvZGl2PlxuXHRcdFx0XHRcdFxuXHRcdFx0XHRcdDxkaXYgaWQ9XCJJbnB1dENvbnRhaW5lclwiPlxuXHRcdFx0XHRcdFx0PElucHV0Q29tcG9uZW50IG1vZGVsPXttb2RlbH0vPlxuXHRcdFx0XHRcdDwvZGl2PlxuXG5cdFx0XHRcdFx0PFByaW50TGlzdENvbXBvbmVudCByZXM9e3RoaXMuc3RhdGUubGlzdH0vPlxuXG5cdFx0XHRcdDwvZGl2PlxuXHRcdFx0PC9kaXY+XG5cblx0XHRcdDwvZGl2PlxuXG5cdFx0KTtcblx0fVxufSk7XG5cbnZhciBNZW51ID0gUmVhY3QuY3JlYXRlQ2xhc3Moe1xuXHRnZXRJbml0aWFsU3RhdGU6IGZ1bmN0aW9uKCkge1xuXHRcdHJldHVybiB7XG5cdFx0XHR2aXNpYmxlOiBmYWxzZVx0XG5cdFx0fTtcblx0fSxcblxuXHRzaG93OiBmdW5jdGlvbigpIHtcblx0XHR0aGlzLnNldFN0YXRlKHsgdmlzaWJsZTogdHJ1ZSB9KTtcblx0XHRkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgdGhpcy5oaWRlLmJpbmQodGhpcykpO1xuXHR9LFxuXG5cdGhpZGU6IGZ1bmN0aW9uKCkge1xuXHRcdGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCB0aGlzLmhpZGUuYmluZCh0aGlzKSk7XG5cdFx0dGhpcy5zZXRTdGF0ZSh7IHZpc2libGU6IGZhbHNlIH0pO1xuXHR9LFxuXG5cdHJlbmRlcjogZnVuY3Rpb24oKSB7XG5cdFx0cmV0dXJuIChcblx0XHQ8ZGl2IGNsYXNzTmFtZT1cIlwiPlxuXHRcdFx0PGRpdiBjbGFzc05hbWU9e1wic2xpZGUtbWVudS1cIisodGhpcy5zdGF0ZS52aXNpYmxlID8gXCJ2aXNpYmxlIFwiIDogXCJcIikrIFwiIHNsaWRlLW1lbnVcIn0+XG5cdFx0XHRcdHt0aGlzLnByb3BzLmNoaWxkcmVufVxuXHRcdFx0PC9kaXY+XG5cdFx0PC9kaXY+KTtcblx0fVxufSk7XG5cbnZhciBNZW51SXRlbSA9IFJlYWN0LmNyZWF0ZUNsYXNzKHtcblx0bmF2aWdhdGU6IGZ1bmN0aW9uKGhhc2gpIHtcblx0XHR3aW5kb3cubG9jYXRpb24uaGFzaCA9IGhhc2g7XG5cdH0sXG5cblx0cmVuZGVyOiBmdW5jdGlvbigpIHtcblx0XHRyZXR1cm4gPGRpdiBjbGFzc05hbWU9XCJzbGlkZS1tZW51LWl0ZW1cIiBvbkNsaWNrPXt0aGlzLm5hdmlnYXRlLmJpbmQodGhpcywgdGhpcy5wcm9wcy5oYXNoKX0+e3RoaXMucHJvcHMuY2hpbGRyZW59PC9kaXY+O1xuXHR9XG59KTtcblxudmFyIEFwcCA9IFJlYWN0LmNyZWF0ZUNsYXNzKHtcblx0Z2V0SW5pdGlhbFN0YXRlOiBmdW5jdGlvbigpe1xuXHRcdHJldHVybiB7XG5cdFx0XHRwYWdlOiAwXG5cdFx0fVxuXHR9LFxuXHRyZW5kZXI6IGZ1bmN0aW9uICgpIHtcblx0XHRyZXR1cm4gKFxuXHRcdFx0PGRpdj5cblx0XHRcdFx0PE1lbnU+XG5cdFx0XHRcdFx0PE1lbnVJdGVtIGhhc2g9XCIjV1RGXCI+SGVsbG88L01lbnVJdGVtPlxuXHRcdFx0XHRcdDxNZW51SXRlbSBoYXNoPVwiI1dURjFcIj5Ob1dheTwvTWVudUl0ZW0+XG5cdFx0XHRcdFx0PE1lbnVJdGVtIGhhc2g9XCIjV1RGMlwiPlNoaXQ8L01lbnVJdGVtPlxuXG5cdFx0XHRcdDwvTWVudT5cblx0XHRcdFx0PFZpZXdDaGFuZ2VyIHZpZXdzPXtbR2VuZXJhdG9yXX0gaWQ9e3RoaXMuc3RhdGUucGFnZX0gLz5cblxuXHRcdFx0PC9kaXY+XG5cdFx0KTtcblx0fVxufSk7XG5cblJlYWN0LnJlbmRlcig8QXBwLz4sZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJjb250ZW50XCIpKVxuUmVhY3QucmVuZGVyKDxVc2VyRm9ybSBkYXRhPXttb2RlbC51c2VyfS8+LGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwidXNlclwiKSlcblxuXG4iXX0=