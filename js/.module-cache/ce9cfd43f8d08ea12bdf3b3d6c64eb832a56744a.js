
/*
var data = {
	fraction    : 50,
	natural		: 50,
	irrational	: 0,
	up	: {low:1 ,high:10},
	down: {low:1 ,high:10}
}
*/
var model = {
	view_id: 0,
	data: {

	},
	addres: "",
	user: {
		name: "",
		pass: ""
	},
	res :{

	}
}

function checkStorageForDataOrReturnDefault(def){
	if(localStorage[model.addres] != null && localStorage[model.addres] != ""){
		return JSON.parse(localStorage[model.addres]);
	}else{
		return def
	}
}

/** @jsx React.DOM */
var MathComponent = React.createClass({displayName: "MathComponent",
	componentDidUpdate:function(prevProps, prevState){

		var problem = this.refs.problem.getDOMNode()
		var solution = this.refs.solution.getDOMNode()
		katex.render(this.props.math[0].problem,problem)
		katex.render(this.props.math[0].solution,solution)
		
	},
	componentDidMount: function() {
		this.refs.problem.getDOMNode().innerHTML = "За да създадете задача натиснете генерирай"
	},
	render: function(){
		return (
			React.createElement("div", {id: "MathContainer"}, 
				React.createElement("span", {id: "result", ref: "problem"}), 
				React.createElement("span", {style: {display:this.props.solutionVisable ? "block" : "none"}, ref: "solution"})
			))
	}
})


var InputComponent = React.createClass({displayName: "InputComponent",
	views: [EquivalentExpressions,Equation,QuadraticEquation],
	getInitialState: function(){
		return {view: "div"}
	},
	componentDidMount: function(){
		console.log(this.views)
		routie('problems/type/:id', this.changeView);
	},
	changeView: function(id){
		if(id < this.views.length){
			this.setState({view: this.views[id]})
			model.view_id = id | 0;
		}
	},
	render: function () {
		var data = this.props.model.data
		return (React.createElement(this.state.view,{model:model}));
	}
});

var KaТeXitem = React.createClass({displayName: "KaТeXitem",
	componentDidMount:  function(){

		//console.log(this.props.problem)

		var shit = this.refs.shit.getDOMNode()
		katex.render(this.props.problem,shit)


	},
	componentDidUpdate: function(prevProps, prevState){
		//console.log(this.props.problem)

		var shit = this.refs.shit.getDOMNode()
		katex.render(this.props.problem,shit)
	},
	render: function(){
		return(React.createElement("span", {ref: "shit"}))
	}
})

var PrintListComponent = React.createClass({displayName: "PrintListComponent",
	render: function () {
		problems = this.props.res.map(function(result,iter){
			//console.log(result)
			return (React.createElement("div", {className: "items"}, React.createElement("span", {className: "num"}, iter+1), React.createElement(KaТeXitem, {problem: result.problem})))
		})

		solution = this.props.res.map(function(result,iter){
			//console.log(result)
			return (React.createElement("div", {className: "items"}, React.createElement("span", {className: "num"}, iter+1), React.createElement(KaТeXitem, {problem: result.solution})))
		})
		var st = {}
		if(this.props.res.length > 0){
			st["display"] = "block"
			ofset = document.getElementById("anchor").offsetTop;
			
		}else{
			st["display"] = "none"
		}

		return (

			React.createElement("div", {id: "anchor", style: st, className: "list"}, 
				"Задачи:", 
				problems, 
				React.createElement("br", null), 
				"Отговори:", 
				problems
			)
		)
	}
});


var MenuList = React.createClass({displayName: "MenuList",
	getInitialState: function () {
		return {
			selected: model.view_id
		};
	},
	change: function(index){
		console.log(index)
		this.setState({selected: index})
	},
	render: function(){
		var self = this;
		var list = this.props.items.map(function(item,index){
			var style = ""
			if(self.state.selected == index){
				style = "selected"
			}
			return React.createElement("a", {className: style, href: item.href, onClick: self.change.bind(self,index)}, item.text)
		})
		return (React.createElement("div", null, list))
	}
}) 

var ViewChanger = React.createClass({displayName: "ViewChanger",

	render: function () {
		console.log(this.props)
		if(this.props.id < this.props.views.length){
			return (React.createElement(this.props.views[this.props.id],{model:model}));
		}else{
			return React.createElement("div", null)
		}
	}
});


var Generator = React.createClass({displayName: "Generator",
	getInitialState: function(){
		return {
			math: [{problem: "", solution: ""}],
			sv: false,
			list: []
		}
	},
	submit: function(){
		self = this
		localStorage[model.addres] = JSON.stringify(model.data)
		superagent.post("/api" + model.addres).send(model.data).send({cor:1}).end(function(res){
			if(res.status == 200){
				model.res = JSON.parse(res.text)
				self.setState({math: model.res})

			}else{
				self.setState({math: {problem: "error",solution:" --- "} })

				//katex.render("error",problem)


			}
		});
		//alert(math)
		//console.log(math)
		
		//this.setState({math: math})
	},
	submit_more: function(){
		self = this
		localStorage[model.addres] = JSON.stringify(model.data)
		
		
		superagent.post("/api" + model.addres).send(model.data).send({cor:10}).end(function(res){
			if(res.status == 200){
				model.res = JSON.parse(res.text)
				console.log(model.res)

				self.setState({list: model.res})
				console.log(ofset)
				scrollTo(0,ofset)

			}else{
				//katex.render("error",problem)


			}
		});


		//alert(math)
		//console.log(math)
	},
	show: function(){
		this.setState({sv: !this.state.sv});
	},
	render: function () {
		return (
			React.createElement("div", null, 

			React.createElement(MathComponent, {math: this.state.math, solutionVisable: this.state.sv}), 

			React.createElement("div", {id: "sidebar"}, 
					React.createElement("div", {className: "item"}, 
						React.createElement("span", null, "7 клас"), 
						React.createElement(MenuList, {items: [
							{href: "#problems/type/0", text:"Tъждествени изрази"},
							{href: "#problems/type/1", text:"Уравнения"}
							]})
					)
			), 

			React.createElement("div", {id: "inner-content"}, 
				
				React.createElement("div", null, 
					React.createElement("div", {className: "menu"}, 
						React.createElement("div", {className: "menu-item", onClick: this.submit}, "Генерирай"), 
						React.createElement("div", {className: "menu-item", onClick: this.submit_more}, "Генерирай няколко"), 
						React.createElement("div", {className: "menu-item", onClick: this.show}, "Покажи/скрий отговорите")
					), 
					
					React.createElement("div", {id: "InputContainer"}, 
						React.createElement(InputComponent, {model: model})
					), 

					React.createElement(PrintListComponent, {res: this.state.list})

				)
			)

			)

		);
	}
});

var Menu = React.createClass({displayName: "Menu",
	getInitialState: function() {
		return {
			visible: false	
		};
	},

	show: function() {
		this.setState({ visible: true });
		document.addEventListener("click", this.hide.bind(this));
	},

	hide: function() {
		document.removeEventListener("click", this.hide.bind(this));
		this.setState({ visible: false });
	},

	render: function() {
		return (
		React.createElement("div", {className: ""}, 
			React.createElement("div", {className: "slide-menu-"+(this.state.visible ? "visible " : "")+ " slide-menu"}, 
				this.props.children
			)
		));
	}
});

var MenuItem = React.createClass({displayName: "MenuItem",
	navigate: function(hash) {
		window.location.hash = hash;
	},

	render: function() {
		return React.createElement("div", {className: "slide-menu-item", onClick: this.navigate.bind(this, this.props.hash)}, this.props.children);
	}
});

var App = React.createClass({displayName: "App",
	getInitialState: function(){
		return {
			page: 0
		}
	},
	render: function () {
		return (
			React.createElement("div", null, 
				React.createElement(Menu, null, 
					React.createElement(MenuItem, {hash: "#WTF"}, "Hello"), 
					React.createElement(MenuItem, {hash: "#WTF1"}, "NoWay"), 
					React.createElement(MenuItem, {hash: "#WTF2"}, "Shit")

				), 
				React.createElement(ViewChanger, {views: [Generator], id: this.state.page})

			)
		);
	}
});

React.render(React.createElement(App, null),document.getElementById("content"))
React.render(React.createElement(UserForm, {data: model.user}),document.getElementById("user"))



//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJhbnNmb3JtZWQuanMiLCJzb3VyY2VzIjpbbnVsbF0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0VBRUU7QUFDRixJQUFJLEtBQUssR0FBRztDQUNYLE9BQU8sRUFBRSxDQUFDO0FBQ1gsQ0FBQyxJQUFJLEVBQUU7O0VBRUw7Q0FDRCxNQUFNLEVBQUUsRUFBRTtDQUNWLElBQUksRUFBRTtFQUNMLElBQUksRUFBRSxFQUFFO0VBQ1IsSUFBSSxFQUFFLEVBQUU7RUFDUjtBQUNGLENBQUMsR0FBRyxFQUFFOztFQUVKO0FBQ0YsQ0FBQzs7QUFFRCxTQUFTLGtDQUFrQyxDQUFDLEdBQUcsQ0FBQztDQUMvQyxHQUFHLFlBQVksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLElBQUksSUFBSSxJQUFJLFlBQVksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLElBQUksRUFBRSxDQUFDO0VBQ3pFLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxZQUFZLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7RUFDOUMsSUFBSTtFQUNKLE9BQU8sR0FBRztFQUNWO0FBQ0YsQ0FBQzs7QUFFRCxxQkFBcUI7QUFDckIsSUFBSSxtQ0FBbUMsNkJBQUE7QUFDdkMsQ0FBQyxrQkFBa0IsQ0FBQyxTQUFTLFNBQVMsRUFBRSxTQUFTLENBQUM7O0VBRWhELElBQUksT0FBTyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLFVBQVUsRUFBRTtFQUM1QyxJQUFJLFFBQVEsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxVQUFVLEVBQUU7RUFDOUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDO0FBQ2xELEVBQUUsS0FBSyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFD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QUUsS0FBSyxDQUFDLElBQUssQ0FBRSxDQUFBLENBQUMsUUFBUSxDQUFDLGNBQWMsQ0FBQyxNQUFNLENBQUMsQ0FBQztBQUMzRSIsInNvdXJjZXNDb250ZW50IjpbIlxuLypcbnZhciBkYXRhID0ge1xuXHRmcmFjdGlvbiAgICA6IDUwLFxuXHRuYXR1cmFsXHRcdDogNTAsXG5cdGlycmF0aW9uYWxcdDogMCxcblx0dXBcdDoge2xvdzoxICxoaWdoOjEwfSxcblx0ZG93bjoge2xvdzoxICxoaWdoOjEwfVxufVxuKi9cbnZhciBtb2RlbCA9IHtcblx0dmlld19pZDogMCxcblx0ZGF0YToge1xuXG5cdH0sXG5cdGFkZHJlczogXCJcIixcblx0dXNlcjoge1xuXHRcdG5hbWU6IFwiXCIsXG5cdFx0cGFzczogXCJcIlxuXHR9LFxuXHRyZXMgOntcblxuXHR9XG59XG5cbmZ1bmN0aW9uIGNoZWNrU3RvcmFnZUZvckRhdGFPclJldHVybkRlZmF1bHQoZGVmKXtcblx0aWYobG9jYWxTdG9yYWdlW21vZGVsLmFkZHJlc10gIT0gbnVsbCAmJiBsb2NhbFN0b3JhZ2VbbW9kZWwuYWRkcmVzXSAhPSBcIlwiKXtcblx0XHRyZXR1cm4gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2VbbW9kZWwuYWRkcmVzXSk7XG5cdH1lbHNle1xuXHRcdHJldHVybiBkZWZcblx0fVxufVxuXG4vKiogQGpzeCBSZWFjdC5ET00gKi9cbnZhciBNYXRoQ29tcG9uZW50ID0gUmVhY3QuY3JlYXRlQ2xhc3Moe1xuXHRjb21wb25lbnREaWRVcGRhdGU6ZnVuY3Rpb24ocHJldlByb3BzLCBwcmV2U3RhdGUpe1xuXG5cdFx0dmFyIHByb2JsZW0gPSB0aGlzLnJlZnMucHJvYmxlbS5nZXRET01Ob2RlKClcblx0XHR2YXIgc29sdXRpb24gPSB0aGlzLnJlZnMuc29sdXRpb24uZ2V0RE9NTm9kZSgpXG5cdFx0a2F0ZXgucmVuZGVyKHRoaXMucHJvcHMubWF0aFswXS5wcm9ibGVtLHByb2JsZW0pXG5cdFx0a2F0ZXgucmVuZGVyKHRoaXMucHJvcHMubWF0aFswXS5zb2x1dGlvbixzb2x1dGlvbilcblx0XHRcblx0fSxcblx0Y29tcG9uZW50RGlkTW91bnQ6IGZ1bmN0aW9uKCkge1xuXHRcdHRoaXMucmVmcy5wcm9ibGVtLmdldERPTU5vZGUoKS5pbm5lckhUTUwgPSBcItCX0LAg0LTQsCDRgdGK0LfQtNCw0LTQtdGC0LUg0LfQsNC00LDRh9CwINC90LDRgtC40YHQvdC10YLQtSDQs9C10L3QtdGA0LjRgNCw0LlcIlxuXHR9LFxuXHRyZW5kZXI6IGZ1bmN0aW9uKCl7XG5cdFx0cmV0dXJuIChcblx0XHRcdDxkaXYgaWQ9XCJNYXRoQ29udGFpbmVyXCI+XG5cdFx0XHRcdDxzcGFuIGlkPVwicmVzdWx0XCIgcmVmPVwicHJvYmxlbVwiPjwvc3Bhbj5cblx0XHRcdFx0PHNwYW4gc3R5bGU9e3tkaXNwbGF5OnRoaXMucHJvcHMuc29sdXRpb25WaXNhYmxlID8gXCJibG9ja1wiIDogXCJub25lXCJ9fSByZWY9XCJzb2x1dGlvblwiPjwvc3Bhbj5cblx0XHRcdDwvZGl2Pilcblx0fVxufSlcblxuXG52YXIgSW5wdXRDb21wb25lbnQgPSBSZWFjdC5jcmVhdGVDbGFzcyh7XG5cdHZpZXdzOiBbRXF1aXZhbGVudEV4cHJlc3Npb25zLEVxdWF0aW9uLFF1YWRyYXRpY0VxdWF0aW9uXSxcblx0Z2V0SW5pdGlhbFN0YXRlOiBmdW5jdGlvbigpe1xuXHRcdHJldHVybiB7dmlldzogXCJkaXZcIn1cblx0fSxcblx0Y29tcG9uZW50RGlkTW91bnQ6IGZ1bmN0aW9uKCl7XG5cdFx0Y29uc29sZS5sb2codGhpcy52aWV3cylcblx0XHRyb3V0aWUoJ3Byb2JsZW1zL3R5cGUvOmlkJywgdGhpcy5jaGFuZ2VWaWV3KTtcblx0fSxcblx0Y2hhbmdlVmlldzogZnVuY3Rpb24oaWQpe1xuXHRcdGlmKGlkIDwgdGhpcy52aWV3cy5sZW5ndGgpe1xuXHRcdFx0dGhpcy5zZXRTdGF0ZSh7dmlldzogdGhpcy52aWV3c1tpZF19KVxuXHRcdFx0bW9kZWwudmlld19pZCA9IGlkIHwgMDtcblx0XHR9XG5cdH0sXG5cdHJlbmRlcjogZnVuY3Rpb24gKCkge1xuXHRcdHZhciBkYXRhID0gdGhpcy5wcm9wcy5tb2RlbC5kYXRhXG5cdFx0cmV0dXJuIChSZWFjdC5jcmVhdGVFbGVtZW50KHRoaXMuc3RhdGUudmlldyx7bW9kZWw6bW9kZWx9KSk7XG5cdH1cbn0pO1xuXG52YXIgS2HQomVYaXRlbSA9IFJlYWN0LmNyZWF0ZUNsYXNzKHtcblx0Y29tcG9uZW50RGlkTW91bnQ6ICBmdW5jdGlvbigpe1xuXG5cdFx0Ly9jb25zb2xlLmxvZyh0aGlzLnByb3BzLnByb2JsZW0pXG5cblx0XHR2YXIgc2hpdCA9IHRoaXMucmVmcy5zaGl0LmdldERPTU5vZGUoKVxuXHRcdGthdGV4LnJlbmRlcih0aGlzLnByb3BzLnByb2JsZW0sc2hpdClcblxuXG5cdH0sXG5cdGNvbXBvbmVudERpZFVwZGF0ZTogZnVuY3Rpb24ocHJldlByb3BzLCBwcmV2U3RhdGUpe1xuXHRcdC8vY29uc29sZS5sb2codGhpcy5wcm9wcy5wcm9ibGVtKVxuXG5cdFx0dmFyIHNoaXQgPSB0aGlzLnJlZnMuc2hpdC5nZXRET01Ob2RlKClcblx0XHRrYXRleC5yZW5kZXIodGhpcy5wcm9wcy5wcm9ibGVtLHNoaXQpXG5cdH0sXG5cdHJlbmRlcjogZnVuY3Rpb24oKXtcblx0XHRyZXR1cm4oPHNwYW4gIHJlZj1cInNoaXRcIj48L3NwYW4+KVxuXHR9XG59KVxuXG52YXIgUHJpbnRMaXN0Q29tcG9uZW50ID0gUmVhY3QuY3JlYXRlQ2xhc3Moe1xuXHRyZW5kZXI6IGZ1bmN0aW9uICgpIHtcblx0XHRwcm9ibGVtcyA9IHRoaXMucHJvcHMucmVzLm1hcChmdW5jdGlvbihyZXN1bHQsaXRlcil7XG5cdFx0XHQvL2NvbnNvbGUubG9nKHJlc3VsdClcblx0XHRcdHJldHVybiAoPGRpdiBjbGFzc05hbWU9XCJpdGVtc1wiPjxzcGFuIGNsYXNzTmFtZT1cIm51bVwiPntpdGVyKzF9PC9zcGFuPjxLYdCiZVhpdGVtIHByb2JsZW09e3Jlc3VsdC5wcm9ibGVtfSAvPjwvZGl2Pilcblx0XHR9KVxuXG5cdFx0c29sdXRpb24gPSB0aGlzLnByb3BzLnJlcy5tYXAoZnVuY3Rpb24ocmVzdWx0LGl0ZXIpe1xuXHRcdFx0Ly9jb25zb2xlLmxvZyhyZXN1bHQpXG5cdFx0XHRyZXR1cm4gKDxkaXYgY2xhc3NOYW1lPVwiaXRlbXNcIj48c3BhbiBjbGFzc05hbWU9XCJudW1cIj57aXRlcisxfTwvc3Bhbj48S2HQomVYaXRlbSBwcm9ibGVtPXtyZXN1bHQuc29sdXRpb259IC8+PC9kaXY+KVxuXHRcdH0pXG5cdFx0dmFyIHN0ID0ge31cblx0XHRpZih0aGlzLnByb3BzLnJlcy5sZW5ndGggPiAwKXtcblx0XHRcdHN0W1wiZGlzcGxheVwiXSA9IFwiYmxvY2tcIlxuXHRcdFx0b2ZzZXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImFuY2hvclwiKS5vZmZzZXRUb3A7XG5cdFx0XHRcblx0XHR9ZWxzZXtcblx0XHRcdHN0W1wiZGlzcGxheVwiXSA9IFwibm9uZVwiXG5cdFx0fVxuXG5cdFx0cmV0dXJuIChcblxuXHRcdFx0PGRpdiBpZD1cImFuY2hvclwiIHN0eWxlPXtzdH0gY2xhc3NOYW1lPVwibGlzdFwiPlxuXHRcdFx0XHTQl9Cw0LTQsNGH0Lg6XG5cdFx0XHRcdHtwcm9ibGVtc31cblx0XHRcdFx0PGJyIC8+XG5cdFx0XHRcdNCe0YLQs9C+0LLQvtGA0Lg6XG5cdFx0XHRcdHtwcm9ibGVtc31cblx0XHRcdDwvZGl2PlxuXHRcdClcblx0fVxufSk7XG5cblxudmFyIE1lbnVMaXN0ID0gUmVhY3QuY3JlYXRlQ2xhc3Moe1xuXHRnZXRJbml0aWFsU3RhdGU6IGZ1bmN0aW9uICgpIHtcblx0XHRyZXR1cm4ge1xuXHRcdFx0c2VsZWN0ZWQ6IG1vZGVsLnZpZXdfaWRcblx0XHR9O1xuXHR9LFxuXHRjaGFuZ2U6IGZ1bmN0aW9uKGluZGV4KXtcblx0XHRjb25zb2xlLmxvZyhpbmRleClcblx0XHR0aGlzLnNldFN0YXRlKHtzZWxlY3RlZDogaW5kZXh9KVxuXHR9LFxuXHRyZW5kZXI6IGZ1bmN0aW9uKCl7XG5cdFx0dmFyIHNlbGYgPSB0aGlzO1xuXHRcdHZhciBsaXN0ID0gdGhpcy5wcm9wcy5pdGVtcy5tYXAoZnVuY3Rpb24oaXRlbSxpbmRleCl7XG5cdFx0XHR2YXIgc3R5bGUgPSBcIlwiXG5cdFx0XHRpZihzZWxmLnN0YXRlLnNlbGVjdGVkID09IGluZGV4KXtcblx0XHRcdFx0c3R5bGUgPSBcInNlbGVjdGVkXCJcblx0XHRcdH1cblx0XHRcdHJldHVybiA8YSBjbGFzc05hbWU9e3N0eWxlfSBocmVmPXtpdGVtLmhyZWZ9IG9uQ2xpY2s9e3NlbGYuY2hhbmdlLmJpbmQoc2VsZixpbmRleCl9PntpdGVtLnRleHR9PC9hPlxuXHRcdH0pXG5cdFx0cmV0dXJuICg8ZGl2PntsaXN0fTwvZGl2Pilcblx0fVxufSkgXG5cbnZhciBWaWV3Q2hhbmdlciA9IFJlYWN0LmNyZWF0ZUNsYXNzKHtcblxuXHRyZW5kZXI6IGZ1bmN0aW9uICgpIHtcblx0XHRjb25zb2xlLmxvZyh0aGlzLnByb3BzKVxuXHRcdGlmKHRoaXMucHJvcHMuaWQgPCB0aGlzLnByb3BzLnZpZXdzLmxlbmd0aCl7XG5cdFx0XHRyZXR1cm4gKFJlYWN0LmNyZWF0ZUVsZW1lbnQodGhpcy5wcm9wcy52aWV3c1t0aGlzLnByb3BzLmlkXSx7bW9kZWw6bW9kZWx9KSk7XG5cdFx0fWVsc2V7XG5cdFx0XHRyZXR1cm4gPGRpdj48L2Rpdj5cblx0XHR9XG5cdH1cbn0pO1xuXG5cbnZhciBHZW5lcmF0b3IgPSBSZWFjdC5jcmVhdGVDbGFzcyh7XG5cdGdldEluaXRpYWxTdGF0ZTogZnVuY3Rpb24oKXtcblx0XHRyZXR1cm4ge1xuXHRcdFx0bWF0aDogW3twcm9ibGVtOiBcIlwiLCBzb2x1dGlvbjogXCJcIn1dLFxuXHRcdFx0c3Y6IGZhbHNlLFxuXHRcdFx0bGlzdDogW11cblx0XHR9XG5cdH0sXG5cdHN1Ym1pdDogZnVuY3Rpb24oKXtcblx0XHRzZWxmID0gdGhpc1xuXHRcdGxvY2FsU3RvcmFnZVttb2RlbC5hZGRyZXNdID0gSlNPTi5zdHJpbmdpZnkobW9kZWwuZGF0YSlcblx0XHRzdXBlcmFnZW50LnBvc3QoXCIvYXBpXCIgKyBtb2RlbC5hZGRyZXMpLnNlbmQobW9kZWwuZGF0YSkuc2VuZCh7Y29yOjF9KS5lbmQoZnVuY3Rpb24ocmVzKXtcblx0XHRcdGlmKHJlcy5zdGF0dXMgPT0gMjAwKXtcblx0XHRcdFx0bW9kZWwucmVzID0gSlNPTi5wYXJzZShyZXMudGV4dClcblx0XHRcdFx0c2VsZi5zZXRTdGF0ZSh7bWF0aDogbW9kZWwucmVzfSlcblxuXHRcdFx0fWVsc2V7XG5cdFx0XHRcdHNlbGYuc2V0U3RhdGUoe21hdGg6IHtwcm9ibGVtOiBcImVycm9yXCIsc29sdXRpb246XCIgLS0tIFwifSB9KVxuXG5cdFx0XHRcdC8va2F0ZXgucmVuZGVyKFwiZXJyb3JcIixwcm9ibGVtKVxuXG5cblx0XHRcdH1cblx0XHR9KTtcblx0XHQvL2FsZXJ0KG1hdGgpXG5cdFx0Ly9jb25zb2xlLmxvZyhtYXRoKVxuXHRcdFxuXHRcdC8vdGhpcy5zZXRTdGF0ZSh7bWF0aDogbWF0aH0pXG5cdH0sXG5cdHN1Ym1pdF9tb3JlOiBmdW5jdGlvbigpe1xuXHRcdHNlbGYgPSB0aGlzXG5cdFx0bG9jYWxTdG9yYWdlW21vZGVsLmFkZHJlc10gPSBKU09OLnN0cmluZ2lmeShtb2RlbC5kYXRhKVxuXHRcdFxuXHRcdFxuXHRcdHN1cGVyYWdlbnQucG9zdChcIi9hcGlcIiArIG1vZGVsLmFkZHJlcykuc2VuZChtb2RlbC5kYXRhKS5zZW5kKHtjb3I6MTB9KS5lbmQoZnVuY3Rpb24ocmVzKXtcblx0XHRcdGlmKHJlcy5zdGF0dXMgPT0gMjAwKXtcblx0XHRcdFx0bW9kZWwucmVzID0gSlNPTi5wYXJzZShyZXMudGV4dClcblx0XHRcdFx0Y29uc29sZS5sb2cobW9kZWwucmVzKVxuXG5cdFx0XHRcdHNlbGYuc2V0U3RhdGUoe2xpc3Q6IG1vZGVsLnJlc30pXG5cdFx0XHRcdGNvbnNvbGUubG9nKG9mc2V0KVxuXHRcdFx0XHRzY3JvbGxUbygwLG9mc2V0KVxuXG5cdFx0XHR9ZWxzZXtcblx0XHRcdFx0Ly9rYXRleC5yZW5kZXIoXCJlcnJvclwiLHByb2JsZW0pXG5cblxuXHRcdFx0fVxuXHRcdH0pO1xuXG5cblx0XHQvL2FsZXJ0KG1hdGgpXG5cdFx0Ly9jb25zb2xlLmxvZyhtYXRoKVxuXHR9LFxuXHRzaG93OiBmdW5jdGlvbigpe1xuXHRcdHRoaXMuc2V0U3RhdGUoe3N2OiAhdGhpcy5zdGF0ZS5zdn0pO1xuXHR9LFxuXHRyZW5kZXI6IGZ1bmN0aW9uICgpIHtcblx0XHRyZXR1cm4gKFxuXHRcdFx0PGRpdj5cblxuXHRcdFx0PE1hdGhDb21wb25lbnQgbWF0aD17dGhpcy5zdGF0ZS5tYXRofSBzb2x1dGlvblZpc2FibGU9e3RoaXMuc3RhdGUuc3Z9Lz5cblxuXHRcdFx0PGRpdiBpZD1cInNpZGViYXJcIj5cblx0XHRcdFx0XHQ8ZGl2IGNsYXNzTmFtZT1cIml0ZW1cIj5cblx0XHRcdFx0XHRcdDxzcGFuPjcg0LrQu9Cw0YE8L3NwYW4+XG5cdFx0XHRcdFx0XHQ8TWVudUxpc3QgaXRlbXM9e1tcblx0XHRcdFx0XHRcdFx0e2hyZWY6IFwiI3Byb2JsZW1zL3R5cGUvMFwiLCB0ZXh0OlwiVNGK0LbQtNC10YHRgtCy0LXQvdC4INC40LfRgNCw0LfQuFwifSxcblx0XHRcdFx0XHRcdFx0e2hyZWY6IFwiI3Byb2JsZW1zL3R5cGUvMVwiLCB0ZXh0Olwi0KPRgNCw0LLQvdC10L3QuNGPXCJ9XG5cdFx0XHRcdFx0XHRcdF19IC8+XG5cdFx0XHRcdFx0PC9kaXY+XG5cdFx0XHQ8L2Rpdj5cblxuXHRcdFx0PGRpdiBpZD1cImlubmVyLWNvbnRlbnRcIiA+XG5cdFx0XHRcdFxuXHRcdFx0XHQ8ZGl2PlxuXHRcdFx0XHRcdDxkaXYgY2xhc3NOYW1lPVwibWVudVwiPlxuXHRcdFx0XHRcdFx0PGRpdiBjbGFzc05hbWU9XCJtZW51LWl0ZW1cIiBvbkNsaWNrPXt0aGlzLnN1Ym1pdH0+0JPQtdC90LXRgNC40YDQsNC5PC9kaXY+XG5cdFx0XHRcdFx0XHQ8ZGl2IGNsYXNzTmFtZT1cIm1lbnUtaXRlbVwiIG9uQ2xpY2s9e3RoaXMuc3VibWl0X21vcmV9PtCT0LXQvdC10YDQuNGA0LDQuSDQvdGP0LrQvtC70LrQvjwvZGl2PlxuXHRcdFx0XHRcdFx0PGRpdiBjbGFzc05hbWU9XCJtZW51LWl0ZW1cIiBvbkNsaWNrPXt0aGlzLnNob3d9PtCf0L7QutCw0LbQuC/RgdC60YDQuNC5INC+0YLQs9C+0LLQvtGA0LjRgtC1PC9kaXY+XG5cdFx0XHRcdFx0PC9kaXY+XG5cdFx0XHRcdFx0XG5cdFx0XHRcdFx0PGRpdiBpZD1cIklucHV0Q29udGFpbmVyXCI+XG5cdFx0XHRcdFx0XHQ8SW5wdXRDb21wb25lbnQgbW9kZWw9e21vZGVsfS8+XG5cdFx0XHRcdFx0PC9kaXY+XG5cblx0XHRcdFx0XHQ8UHJpbnRMaXN0Q29tcG9uZW50IHJlcz17dGhpcy5zdGF0ZS5saXN0fS8+XG5cblx0XHRcdFx0PC9kaXY+XG5cdFx0XHQ8L2Rpdj5cblxuXHRcdFx0PC9kaXY+XG5cblx0XHQpO1xuXHR9XG59KTtcblxudmFyIE1lbnUgPSBSZWFjdC5jcmVhdGVDbGFzcyh7XG5cdGdldEluaXRpYWxTdGF0ZTogZnVuY3Rpb24oKSB7XG5cdFx0cmV0dXJuIHtcblx0XHRcdHZpc2libGU6IGZhbHNlXHRcblx0XHR9O1xuXHR9LFxuXG5cdHNob3c6IGZ1bmN0aW9uKCkge1xuXHRcdHRoaXMuc2V0U3RhdGUoeyB2aXNpYmxlOiB0cnVlIH0pO1xuXHRcdGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCB0aGlzLmhpZGUuYmluZCh0aGlzKSk7XG5cdH0sXG5cblx0aGlkZTogZnVuY3Rpb24oKSB7XG5cdFx0ZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMuaGlkZS5iaW5kKHRoaXMpKTtcblx0XHR0aGlzLnNldFN0YXRlKHsgdmlzaWJsZTogZmFsc2UgfSk7XG5cdH0sXG5cblx0cmVuZGVyOiBmdW5jdGlvbigpIHtcblx0XHRyZXR1cm4gKFxuXHRcdDxkaXYgY2xhc3NOYW1lPVwiXCI+XG5cdFx0XHQ8ZGl2IGNsYXNzTmFtZT17XCJzbGlkZS1tZW51LVwiKyh0aGlzLnN0YXRlLnZpc2libGUgPyBcInZpc2libGUgXCIgOiBcIlwiKSsgXCIgc2xpZGUtbWVudVwifT5cblx0XHRcdFx0e3RoaXMucHJvcHMuY2hpbGRyZW59XG5cdFx0XHQ8L2Rpdj5cblx0XHQ8L2Rpdj4pO1xuXHR9XG59KTtcblxudmFyIE1lbnVJdGVtID0gUmVhY3QuY3JlYXRlQ2xhc3Moe1xuXHRuYXZpZ2F0ZTogZnVuY3Rpb24oaGFzaCkge1xuXHRcdHdpbmRvdy5sb2NhdGlvbi5oYXNoID0gaGFzaDtcblx0fSxcblxuXHRyZW5kZXI6IGZ1bmN0aW9uKCkge1xuXHRcdHJldHVybiA8ZGl2IGNsYXNzTmFtZT1cInNsaWRlLW1lbnUtaXRlbVwiIG9uQ2xpY2s9e3RoaXMubmF2aWdhdGUuYmluZCh0aGlzLCB0aGlzLnByb3BzLmhhc2gpfT57dGhpcy5wcm9wcy5jaGlsZHJlbn08L2Rpdj47XG5cdH1cbn0pO1xuXG52YXIgQXBwID0gUmVhY3QuY3JlYXRlQ2xhc3Moe1xuXHRnZXRJbml0aWFsU3RhdGU6IGZ1bmN0aW9uKCl7XG5cdFx0cmV0dXJuIHtcblx0XHRcdHBhZ2U6IDBcblx0XHR9XG5cdH0sXG5cdHJlbmRlcjogZnVuY3Rpb24gKCkge1xuXHRcdHJldHVybiAoXG5cdFx0XHQ8ZGl2PlxuXHRcdFx0XHQ8TWVudT5cblx0XHRcdFx0XHQ8TWVudUl0ZW0gaGFzaD1cIiNXVEZcIj5IZWxsbzwvTWVudUl0ZW0+XG5cdFx0XHRcdFx0PE1lbnVJdGVtIGhhc2g9XCIjV1RGMVwiPk5vV2F5PC9NZW51SXRlbT5cblx0XHRcdFx0XHQ8TWVudUl0ZW0gaGFzaD1cIiNXVEYyXCI+U2hpdDwvTWVudUl0ZW0+XG5cblx0XHRcdFx0PC9NZW51PlxuXHRcdFx0XHQ8Vmlld0NoYW5nZXIgdmlld3M9e1tHZW5lcmF0b3JdfSBpZD17dGhpcy5zdGF0ZS5wYWdlfSAvPlxuXG5cdFx0XHQ8L2Rpdj5cblx0XHQpO1xuXHR9XG59KTtcblxuUmVhY3QucmVuZGVyKDxBcHAvPixkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImNvbnRlbnRcIikpXG5SZWFjdC5yZW5kZXIoPFVzZXJGb3JtIGRhdGE9e21vZGVsLnVzZXJ9Lz4sZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ1c2VyXCIpKVxuXG5cbiJdfQ==