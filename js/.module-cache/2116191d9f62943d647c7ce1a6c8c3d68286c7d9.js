
/*
var data = {
	fraction    : 50,
	natural		: 50,
	irrational	: 0,
	up	: {low:1 ,high:10},
	down: {low:1 ,high:10}
}
*/
var model = {
	view_id: 0,
	data: {

	},
	addres: "",
	user: {
		name: "",
		pass: ""
	},
	res :{

	}
}

function checkStorageForDataOrReturnDefault(def){
	if(localStorage[model.addres] != null && localStorage[model.addres] != ""){
		return JSON.parse(localStorage[model.addres]);
	}else{
		return def
	}
}

/** @jsx React.DOM */
var MathComponent = React.createClass({displayName: "MathComponent",
	componentDidUpdate:function(prevProps, prevState){

		var problem = this.refs.problem.getDOMNode()
		var solution = this.refs.solution.getDOMNode()
		katex.render(this.props.math[0].problem,problem)
		katex.render(this.props.math[0].solution,solution)
		
	},
	componentDidMount: function() {
		this.refs.problem.getDOMNode().innerHTML = "За да създадете задача натиснете генерирай"
	},
	render: function(){
		return (
			React.createElement("div", {id: "MathContainer"}, 
				React.createElement("span", {id: "result", ref: "problem"}), 
				React.createElement("span", {style: {display:this.props.solutionVisable ? "block" : "none"}, ref: "solution"})
			))
	}
})


var InputComponent = React.createClass({displayName: "InputComponent",
	views: [EquivalentExpressions,Equation,QuadraticEquation],
	getInitialState: function(){
		return {view: "div"}
	},
	componentDidMount: function(){
		console.log(this.views)
		routie('problems/type/:id', this.changeView);
	},
	changeView: function(id){
		if(id < this.views.length){
			this.setState({view: this.views[id]})
			model.view_id = id | 0;
		}
	},
	render: function () {
		var data = this.props.model.data
		return (React.createElement(this.state.view,{model:model}));
	}
});

var KaТeXitem = React.createClass({displayName: "KaТeXitem",
	componentDidMount:  function(){

		//console.log(this.props.problem)

		var shit = this.refs.shit.getDOMNode()
		katex.render(this.props.problem,shit)


	},
	componentDidUpdate: function(prevProps, prevState){
		//console.log(this.props.problem)

		var shit = this.refs.shit.getDOMNode()
		katex.render(this.props.problem,shit)
	},
	render: function(){
		return(React.createElement("span", {ref: "shit"}))
	}
})

var PrintListComponent = React.createClass({displayName: "PrintListComponent",
	render: function () {
		problems = this.props.res.map(function(result,iter){
			//console.log(result)
			return (React.createElement("div", {className: "items"}, React.createElement("span", {className: "num"}, iter+1), React.createElement(KaТeXitem, {problem: result.problem})))
		})

		solution = this.props.res.map(function(result,iter){
			//console.log(result)
			return (React.createElement("div", {className: "items"}, React.createElement("span", {className: "num"}, iter+1), React.createElement(KaТeXitem, {problem: result.solution})))
		})

		return (

			React.createElement("div", {id: "anchor", className: "list"}, 
				"Задачи:", 
				problems, 
				React.createElement("br", null), 
				"Отговори:", 
				problems
			)
		)
	}
});


var MenuList = React.createClass({displayName: "MenuList",
	getInitialState: function () {
		return {
			selected: model.view_id
		};
	},
	change: function(index){
		console.log(index)
		this.setState({selected: index})
	},
	render: function(){
		var self = this;
		var list = this.props.items.map(function(item,index){
			var style = ""
			if(self.state.selected == index){
				style = "selected"
			}
			return React.createElement("a", {className: style, href: item.href, onClick: self.change.bind(self,index)}, item.text)
		})
		return (React.createElement("div", null, list))
	}
}) 

var ViewChanger = React.createClass({displayName: "ViewChanger",

	render: function () {
		console.log(this.props)
		if(this.props.id < this.props.views.length){
			return (React.createElement(this.props.views[this.props.id],{model:model}));
		}else{
			return React.createElement("div", null)
		}
	}
});


var Generator = React.createClass({displayName: "Generator",
	getInitialState: function(){
		return {
			math: [{problem: "", solution: ""}],
			sv: false,
			list: []
		}
	},
	submit: function(){
		self = this
		localStorage[model.addres] = JSON.stringify(model.data)
		superagent.post("/api" + model.addres).send(model.data).send({cor:1}).end(function(res){
			if(res.status == 200){
				model.res = JSON.parse(res.text)
				self.setState({math: model.res})

			}else{
				self.setState({math: {problem: "error",solution:" --- "} })

				//katex.render("error",problem)


			}
		});
		//alert(math)
		//console.log(math)
		
		//this.setState({math: math})
	},
	submit_more: function(){
		self = this
		localStorage[model.addres] = JSON.stringify(model.data)
		ofset = document.getElementById("anchor").offsetTop;
		
		superagent.post("/api" + model.addres).send(model.data).send({cor:10}).end(function(res){
			if(res.status == 200){
				model.res = JSON.parse(res.text)
				console.log(model.res)

				self.setState({list: model.res})
				console.log(ofset)
				scrollTo(0,ofset)

			}else{
				//katex.render("error",problem)


			}
		});


		//alert(math)
		//console.log(math)
	},
	show: function(){
		this.setState({sv: !this.state.sv});
	},
	render: function () {
		return (
			React.createElement("div", null, 

			React.createElement(MathComponent, {math: this.state.math, solutionVisable: this.state.sv}), 

			React.createElement("div", {id: "sidebar"}, 
					React.createElement("div", {className: "item"}, 
						React.createElement("span", null, "7 клас"), 
						React.createElement(MenuList, {items: [
							{href: "#problems/type/0", text:"Tъждествени изрази"},
							{href: "#problems/type/1", text:"Уравнения"}
							]})
					)
			), 

			React.createElement("div", {id: "inner-content"}, 
				
				React.createElement("div", null, 
					React.createElement("div", {className: "menu"}, 
						React.createElement("div", {className: "menu-item", onClick: this.submit}, "Генерирай"), 
						React.createElement("div", {className: "menu-item", onClick: this.submit_more}, "Генерирай няколко"), 
						React.createElement("div", {className: "menu-item", onClick: this.show}, "Покажи/скрий отговорите")
					), 
					
					React.createElement("div", {id: "InputContainer"}, 
						React.createElement(InputComponent, {model: model})
					), 

					React.createElement(PrintListComponent, {res: this.state.list})

				)
			)

			)

		);
	}
});

var Menu = React.createClass({displayName: "Menu",
	getInitialState: function() {
		return {
			visible: false	
		};
	},

	show: function() {
		this.setState({ visible: true });
		document.addEventListener("click", this.hide.bind(this));
	},

	hide: function() {
		document.removeEventListener("click", this.hide.bind(this));
		this.setState({ visible: false });
	},

	render: function() {
		return (
		React.createElement("div", {className: ""}, 
			React.createElement("div", {className: "slide-menu-"+(this.state.visible ? "visible " : "")+ " slide-menu"}, 
				this.props.children
			)
		));
	}
});

var MenuItem = React.createClass({displayName: "MenuItem",
	navigate: function(hash) {
		window.location.hash = hash;
	},

	render: function() {
		return React.createElement("div", {className: "slide-menu-item", onClick: this.navigate.bind(this, this.props.hash)}, this.props.children);
	}
});

var App = React.createClass({displayName: "App",
	getInitialState: function(){
		return {
			page: 0
		}
	},
	render: function () {
		return (
			React.createElement("div", null, 
				React.createElement(Menu, null, 
					React.createElement(MenuItem, {hash: "#WTF"}, "Hello"), 
					React.createElement(MenuItem, {hash: "#WTF1"}, "NoWay"), 
					React.createElement(MenuItem, {hash: "#WTF2"}, "Shit")

				), 
				React.createElement(ViewChanger, {views: [Generator], id: this.state.page})

			)
		);
	}
});

React.render(React.createElement(App, null),document.getElementById("content"))
React.render(React.createElement(UserForm, {data: model.user}),document.getElementById("user"))



//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJhbnNmb3JtZWQuanMiLCJzb3VyY2VzIjpbbnVsbF0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0VBRUU7QUFDRixJQUFJLEtBQUssR0FBRztDQUNYLE9BQU8sRUFBRSxDQUFDO0FBQ1gsQ0FBQyxJQUFJLEVBQUU7O0VBRUw7Q0FDRCxNQUFNLEVBQUUsRUFBRTtDQUNWLElBQUksRUFBRTtFQUNMLElBQUksRUFBRSxFQUFFO0VBQ1IsSUFBSSxFQUFFLEVBQUU7RUFDUjtBQUNGLENBQUMsR0FBRyxFQUFFOztFQUVKO0FBQ0YsQ0FBQzs7QUFFRCxTQUFTLGtDQUFrQyxDQUFDLEdBQUcsQ0FBQztDQUMvQyxHQUFHLFlBQVksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLElBQUksSUFBSSxJQUFJLFlBQVksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLElBQUksRUFBRSxDQUFDO0VBQ3pFLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxZQUFZLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7RUFDOUMsSUFBSTtFQUNKLE9BQU8sR0FBRztFQUNWO0FBQ0YsQ0FBQzs7QUFFRCxxQkFBcUI7QUFDckIsSUFBSSxtQ0FBbUMsNkJBQUE7QUFDdkMsQ0FBQyxrQkFBa0IsQ0FBQyxTQUFTLFNBQVMsRUFBRSxTQUFTLENBQUM7O0VBRWhELElBQUksT0FBTyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLFVBQVUsRUFBRTtFQUM1QyxJQUFJLFFBQVEsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxVQUFVLEVBQUU7RUFDOUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDO0FBQ2xELEVBQUUsS0FBSyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDOztFQUVsRDtDQUNELGlCQUFpQixFQUFFLFdBQVc7RUFDN0IsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsVUFBVSxFQUFFLENBQUMsU0FBUyxHQUFHLDRDQUE0QztFQUN2RjtDQUNELE1BQU0sRUFBRSxVQUFVO0VBQ2pCO0dBQ0Msb0JBQUEsS0FBSSxFQUFBLENBQUEsQ0FBQyxFQUFBLEVBQUUsQ0FBQyxlQUFnQixDQUFBLEVBQUE7SUFDdkIsb0JBQUEsTUFBSyxFQUFBLENBQUEsQ0FBQyxFQUFBLEVBQUUsQ0FBQyxRQUFBLEVBQVEsQ0FBQyxHQUFBLEVBQUcsQ0FBQyxTQUFVLENBQU8sQ0FBQSxFQUFBO0lBQ3ZDLG9CQUFBLE1BQUssRUFBQSxDQUFBLENBQUMsS0FBQSxFQUFLLENBQUUsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxlQUFlLEdBQUcsT0FBTyxHQUFHLE1BQU0sQ0FBQyxFQUFDLENBQUMsR0FBQSxFQUFHLENBQUMsVUFBVyxDQUFPLENBQUE7R0FDdkYsQ0FBQSxDQUFDO0VBQ1I7QUFDRixDQUFDLENBQUM7QUFDRjs7QUFFQSxJQUFJLG9DQUFvQyw4QkFBQTtDQUN2QyxLQUFLLEVBQUUsQ0FBQyxxQkFBcUIsQ0FBQyxRQUFRLENBQUMsaUJBQWlCLENBQUM7Q0FDekQsZUFBZSxFQUFFLFVBQVU7RUFDMUIsT0FBTyxDQUFDLElBQUksRUFBRSxLQUFLLENBQUM7RUFDcEI7Q0FDRCxpQkFBaUIsRUFBRSxVQUFVO0VBQzVCLE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQztFQUN2QixNQUFNLENBQUMsbUJBQW1CLEVBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO0VBQzdDO0NBQ0QsVUFBVSxFQUFFLFNBQVMsRUFBRSxDQUFDO0VBQ3ZCLEdBQUcsRUFBRSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDO0dBQ3pCLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO0dBQ3JDLEtBQUssQ0FBQyxPQUFPLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQztHQUN2QjtFQUNEO0NBQ0QsTUFBTSxFQUFFLFlBQVk7RUFDbkIsSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsSUFBSTtFQUNoQyxRQUFRLEtBQUssQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRTtFQUM1RDtBQUNGLENBQUMsQ0FBQyxDQUFDOztBQUVILElBQUksK0JBQStCLHlCQUFBO0FBQ25DLENBQUMsaUJBQWlCLEdBQUcsVUFBVTtBQUMvQjtBQUNBOztFQUVFLElBQUksSUFBSSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFVBQVUsRUFBRTtBQUN4QyxFQUFFLEtBQUssQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDO0FBQ3ZDOztFQUVFO0FBQ0YsQ0FBQyxrQkFBa0IsRUFBRSxTQUFTLFNBQVMsRUFBRSxTQUFTLENBQUM7QUFDbkQ7O0VBRUUsSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxFQUFFO0VBQ3RDLEtBQUssQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDO0VBQ3JDO0NBQ0QsTUFBTSxFQUFFLFVBQVU7RUFDakIsT0FBTyxvQkFBQSxNQUFLLEVBQUEsQ0FBQSxFQUFFLEdBQUEsRUFBRyxDQUFDLE1BQU8sQ0FBTyxDQUFBLENBQUM7RUFDakM7QUFDRixDQUFDLENBQUM7O0FBRUYsSUFBSSx3Q0FBd0Msa0NBQUE7Q0FDM0MsTUFBTSxFQUFFLFlBQVk7QUFDckIsRUFBRSxRQUFRLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLFNBQVMsTUFBTSxDQUFDLElBQUksQ0FBQzs7R0FFbEQsUUFBUSxvQkFBQSxLQUFJLEVBQUEsQ0FBQSxDQUFDLFNBQUEsRUFBUyxDQUFDLE9BQVEsQ0FBQSxFQUFBLG9CQUFBLE1BQUssRUFBQSxDQUFBLENBQUMsU0FBQSxFQUFTLENBQUMsS0FBTSxDQUFBLEVBQUMsSUFBSSxDQUFDLENBQVMsQ0FBQSxFQUFBLG9CQUFDLFNBQVMsRUFBQSxDQUFBLENBQUMsT0FBQSxFQUFPLENBQUUsTUFBTSxDQUFDLE9BQVEsQ0FBQSxDQUFHLENBQU0sQ0FBQSxDQUFDO0FBQ3BILEdBQUcsQ0FBQzs7QUFFSixFQUFFLFFBQVEsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsU0FBUyxNQUFNLENBQUMsSUFBSSxDQUFDOztHQUVsRCxRQUFRLG9CQUFBLEtBQUksRUFBQSxDQUFBLENBQUMsU0FBQSxFQUFTLENBQUMsT0FBUSxDQUFBLEVBQUEsb0JBQUEsTUFBSyxFQUFBLENBQUEsQ0FBQyxTQUFBLEVBQVMsQ0FBQyxLQUFNLENBQUEsRUFBQyxJQUFJLENBQUMsQ0FBUyxDQUFBLEVBQUEsb0JBQUMsU0FBUyxFQUFBLENBQUEsQ0FBQyxPQUFBLEVBQU8sQ0FBRSxNQUFNLENBQUMsUUFBUyxDQUFBLENBQUcsQ0FBTSxDQUFBLENBQUM7QUFDckgsR0FBRyxDQUFDOztBQUVKLEVBQUU7O0dBRUMsb0JBQUEsS0FBSSxFQUFBLENBQUEsQ0FBQyxFQUFBLEVBQUUsQ0FBQyxRQUFBLEVBQVEsQ0FBQyxTQUFBLEVBQVMsQ0FBQyxNQUFPLENBQUEsRUFBQTtBQUFBLElBQUEsU0FBQSxFQUFBO0FBQUEsSUFFaEMsUUFBUSxFQUFDO0lBQ1Ysb0JBQUEsSUFBRyxFQUFBLElBQUEsQ0FBRyxDQUFBLEVBQUE7QUFBQSxJQUFBLFdBQUEsRUFBQTtBQUFBLElBRUwsUUFBUztHQUNMLENBQUE7R0FDTjtFQUNEO0FBQ0YsQ0FBQyxDQUFDLENBQUM7QUFDSDs7QUFFQSxJQUFJLDhCQUE4Qix3QkFBQTtDQUNqQyxlQUFlLEVBQUUsWUFBWTtFQUM1QixPQUFPO0dBQ04sUUFBUSxFQUFFLEtBQUssQ0FBQyxPQUFPO0dBQ3ZCLENBQUM7RUFDRjtDQUNELE1BQU0sRUFBRSxTQUFTLEtBQUssQ0FBQztFQUN0QixPQUFPLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQztFQUNsQixJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsUUFBUSxFQUFFLEtBQUssQ0FBQyxDQUFDO0VBQ2hDO0NBQ0QsTUFBTSxFQUFFLFVBQVU7RUFDakIsSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDO0VBQ2hCLElBQUksSUFBSSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxTQUFTLElBQUksQ0FBQyxLQUFLLENBQUM7R0FDbkQsSUFBSSxLQUFLLEdBQUcsRUFBRTtHQUNkLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxRQUFRLElBQUksS0FBSyxDQUFDO0lBQy9CLEtBQUssR0FBRyxVQUFVO0lBQ2xCO0dBQ0QsT0FBTyxvQkFBQSxHQUFFLEVBQUEsQ0FBQSxDQUFDLFNBQUEsRUFBUyxDQUFFLEtBQUssRUFBQyxDQUFDLElBQUEsRUFBSSxDQUFFLElBQUksQ0FBQyxJQUFJLEVBQUMsQ0FBQyxPQUFBLEVBQU8sQ0FBRSxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFHLENBQUEsRUFBQyxJQUFJLENBQUMsSUFBUyxDQUFBO0dBQ25HLENBQUM7RUFDRixRQUFRLG9CQUFBLEtBQUksRUFBQSxJQUFDLEVBQUMsSUFBVyxDQUFBLENBQUM7RUFDMUI7QUFDRixDQUFDLENBQUM7O0FBRUYsSUFBSSxpQ0FBaUMsMkJBQUE7O0NBRXBDLE1BQU0sRUFBRSxZQUFZO0VBQ25CLE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQztFQUN2QixHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsRUFBRSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQztHQUMxQyxRQUFRLEtBQUssQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFO0dBQzVFLElBQUk7R0FDSixPQUFPLG9CQUFBLEtBQUksRUFBQSxJQUFPLENBQUE7R0FDbEI7RUFDRDtBQUNGLENBQUMsQ0FBQyxDQUFDO0FBQ0g7O0FBRUEsSUFBSSwrQkFBK0IseUJBQUE7Q0FDbEMsZUFBZSxFQUFFLFVBQVU7RUFDMUIsT0FBTztHQUNOLElBQUksRUFBRSxDQUFDLENBQUMsT0FBTyxFQUFFLEVBQUUsRUFBRSxRQUFRLEVBQUUsRUFBRSxDQUFDLENBQUM7R0FDbkMsRUFBRSxFQUFFLEtBQUs7R0FDVCxJQUFJLEVBQUUsRUFBRTtHQUNSO0VBQ0Q7Q0FDRCxNQUFNLEVBQUUsVUFBVTtFQUNqQixJQUFJLEdBQUcsSUFBSTtFQUNYLFlBQVksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDO0VBQ3ZELFVBQVUsQ0FBQyxJQUFJLENBQUMsTUFBTSxHQUFHLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxTQUFTLEdBQUcsQ0FBQztHQUN0RixHQUFHLEdBQUcsQ0FBQyxNQUFNLElBQUksR0FBRyxDQUFDO0lBQ3BCLEtBQUssQ0FBQyxHQUFHLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDO0FBQ3BDLElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLElBQUksRUFBRSxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7O0lBRWhDLElBQUk7QUFDUixJQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxPQUFPLEVBQUUsT0FBTyxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDO0FBQy9EO0FBQ0E7QUFDQTs7SUFFSTtBQUNKLEdBQUcsQ0FBQyxDQUFDO0FBQ0w7QUFDQTtBQUNBOztFQUVFO0NBQ0QsV0FBVyxFQUFFLFVBQVU7RUFDdEIsSUFBSSxHQUFHLElBQUk7RUFDWCxZQUFZLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQztBQUN6RCxFQUFFLEtBQUssR0FBRyxRQUFRLENBQUMsY0FBYyxDQUFDLFFBQVEsQ0FBQyxDQUFDLFNBQVMsQ0FBQzs7RUFFcEQsVUFBVSxDQUFDLElBQUksQ0FBQyxNQUFNLEdBQUcsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLFNBQVMsR0FBRyxDQUFDO0dBQ3ZGLEdBQUcsR0FBRyxDQUFDLE1BQU0sSUFBSSxHQUFHLENBQUM7SUFDcEIsS0FBSyxDQUFDLEdBQUcsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUM7QUFDcEMsSUFBSSxPQUFPLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUM7O0lBRXRCLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxJQUFJLEVBQUUsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ2hDLE9BQU8sQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDO0FBQ3RCLElBQUksUUFBUSxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUM7O0FBRXJCLElBQUksSUFBSTtBQUNSO0FBQ0E7O0lBRUk7QUFDSixHQUFHLENBQUMsQ0FBQztBQUNMO0FBQ0E7QUFDQTs7RUFFRTtDQUNELElBQUksRUFBRSxVQUFVO0VBQ2YsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztFQUNwQztDQUNELE1BQU0sRUFBRSxZQUFZO0VBQ25CO0FBQ0YsR0FBRyxvQkFBQSxLQUFJLEVBQUEsSUFBQyxFQUFBOztBQUVSLEdBQUcsb0JBQUMsYUFBYSxFQUFBLENBQUEsQ0FBQyxJQUFBLEVBQUksQ0FBRSxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksRUFBQyxDQUFDLGVBQUEsRUFBZSxDQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsRUFBRyxDQUFFLENBQUEsRUFBQTs7R0FFdkUsb0JBQUEsS0FBSSxFQUFBLENBQUEsQ0FBQyxFQUFBLEVBQUUsQ0FBQyxTQUFVLENBQUEsRUFBQTtLQUNoQixvQkFBQSxLQUFJLEVBQUEsQ0FBQSxDQUFDLFNBQUEsRUFBUyxDQUFDLE1BQU8sQ0FBQSxFQUFBO01BQ3JCLG9CQUFBLE1BQUssRUFBQSxJQUFDLEVBQUEsUUFBYSxDQUFBLEVBQUE7TUFDbkIsb0JBQUMsUUFBUSxFQUFBLENBQUEsQ0FBQyxLQUFBLEVBQUssQ0FBRTtPQUNoQixDQUFDLElBQUksRUFBRSxrQkFBa0IsRUFBRSxJQUFJLENBQUMsb0JBQW9CLENBQUM7T0FDckQsQ0FBQyxJQUFJLEVBQUUsa0JBQWtCLEVBQUUsSUFBSSxDQUFDLFdBQVcsQ0FBQztRQUMxQyxDQUFBLENBQUcsQ0FBQTtLQUNELENBQUE7QUFDWCxHQUFTLENBQUEsRUFBQTs7QUFFVCxHQUFHLG9CQUFBLEtBQUksRUFBQSxDQUFBLENBQUMsRUFBQSxFQUFFLENBQUMsZUFBZSxDQUFFLENBQUEsRUFBQTs7SUFFeEIsb0JBQUEsS0FBSSxFQUFBLElBQUMsRUFBQTtLQUNKLG9CQUFBLEtBQUksRUFBQSxDQUFBLENBQUMsU0FBQSxFQUFTLENBQUMsTUFBTyxDQUFBLEVBQUE7TUFDckIsb0JBQUEsS0FBSSxFQUFBLENBQUEsQ0FBQyxTQUFBLEVBQVMsQ0FBQyxXQUFBLEVBQVcsQ0FBQyxPQUFBLEVBQU8sQ0FBRSxJQUFJLENBQUMsTUFBUSxDQUFBLEVBQUEsV0FBZSxDQUFBLEVBQUE7TUFDaEUsb0JBQUEsS0FBSSxFQUFBLENBQUEsQ0FBQyxTQUFBLEVBQVMsQ0FBQyxXQUFBLEVBQVcsQ0FBQyxPQUFBLEVBQU8sQ0FBRSxJQUFJLENBQUMsV0FBYSxDQUFBLEVBQUEsbUJBQXVCLENBQUEsRUFBQTtNQUM3RSxvQkFBQSxLQUFJLEVBQUEsQ0FBQSxDQUFDLFNBQUEsRUFBUyxDQUFDLFdBQUEsRUFBVyxDQUFDLE9BQUEsRUFBTyxDQUFFLElBQUksQ0FBQyxJQUFNLENBQUEsRUFBQSx5QkFBNkIsQ0FBQTtBQUNsRixLQUFXLENBQUEsRUFBQTs7S0FFTixvQkFBQSxLQUFJLEVBQUEsQ0FBQSxDQUFDLEVBQUEsRUFBRSxDQUFDLGdCQUFpQixDQUFBLEVBQUE7TUFDeEIsb0JBQUMsY0FBYyxFQUFBLENBQUEsQ0FBQyxLQUFBLEVBQUssQ0FBRSxLQUFNLENBQUUsQ0FBQTtBQUNyQyxLQUFXLENBQUEsRUFBQTs7QUFFWCxLQUFLLG9CQUFDLGtCQUFrQixFQUFBLENBQUEsQ0FBQyxHQUFBLEVBQUcsQ0FBRSxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUssQ0FBRSxDQUFBOztJQUV0QyxDQUFBO0FBQ1YsR0FBUyxDQUFBOztBQUVULEdBQVMsQ0FBQTs7SUFFTDtFQUNGO0FBQ0YsQ0FBQyxDQUFDLENBQUM7O0FBRUgsSUFBSSwwQkFBMEIsb0JBQUE7Q0FDN0IsZUFBZSxFQUFFLFdBQVc7RUFDM0IsT0FBTztHQUNOLE9BQU8sRUFBRSxLQUFLO0dBQ2QsQ0FBQztBQUNKLEVBQUU7O0NBRUQsSUFBSSxFQUFFLFdBQVc7RUFDaEIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxFQUFFLE9BQU8sRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO0VBQ2pDLFFBQVEsQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztBQUMzRCxFQUFFOztDQUVELElBQUksRUFBRSxXQUFXO0VBQ2hCLFFBQVEsQ0FBQyxtQkFBbUIsQ0FBQyxPQUFPLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztFQUM1RCxJQUFJLENBQUMsUUFBUSxDQUFDLEVBQUUsT0FBTyxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUM7QUFDcEMsRUFBRTs7Q0FFRCxNQUFNLEVBQUUsV0FBVztFQUNsQjtFQUNBLG9CQUFBLEtBQUksRUFBQSxDQUFBLENBQUMsU0FBQSxFQUFTLENBQUMsRUFBRyxDQUFBLEVBQUE7R0FDakIsb0JBQUEsS0FBSSxFQUFBLENBQUEsQ0FBQyxTQUFBLEVBQVMsQ0FBRSxhQUFhLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLEdBQUcsVUFBVSxHQUFHLEVBQUUsQ0FBQyxFQUFFLGFBQWUsQ0FBQSxFQUFBO0lBQ25GLElBQUksQ0FBQyxLQUFLLENBQUMsUUFBUztHQUNoQixDQUFBO0VBQ0QsQ0FBQSxFQUFFO0VBQ1I7QUFDRixDQUFDLENBQUMsQ0FBQzs7QUFFSCxJQUFJLDhCQUE4Qix3QkFBQTtDQUNqQyxRQUFRLEVBQUUsU0FBUyxJQUFJLEVBQUU7RUFDeEIsTUFBTSxDQUFDLFFBQVEsQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDO0FBQzlCLEVBQUU7O0NBRUQsTUFBTSxFQUFFLFdBQVc7RUFDbEIsT0FBTyxvQkFBQSxLQUFJLEVBQUEsQ0FBQSxDQUFDLFNBQUEsRUFBUyxDQUFDLGlCQUFBLEVBQWlCLENBQUMsT0FBQSxFQUFPLENBQUUsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFHLENBQUEsRUFBQyxJQUFJLENBQUMsS0FBSyxDQUFDLFFBQWUsQ0FBQSxDQUFDO0VBQ3hIO0FBQ0YsQ0FBQyxDQUFDLENBQUM7O0FBRUgsSUFBSSx5QkFBeUIsbUJBQUE7Q0FDNUIsZUFBZSxFQUFFLFVBQVU7RUFDMUIsT0FBTztHQUNOLElBQUksRUFBRSxDQUFDO0dBQ1A7RUFDRDtDQUNELE1BQU0sRUFBRSxZQUFZO0VBQ25CO0dBQ0Msb0JBQUEsS0FBSSxFQUFBLElBQUMsRUFBQTtJQUNKLG9CQUFDLElBQUksRUFBQSxJQUFDLEVBQUE7S0FDTCxvQkFBQyxRQUFRLEVBQUEsQ0FBQSxDQUFDLElBQUEsRUFBSSxDQUFDLE1BQU8sQ0FBQSxFQUFBLE9BQWdCLENBQUEsRUFBQTtLQUN0QyxvQkFBQyxRQUFRLEVBQUEsQ0FBQSxDQUFDLElBQUEsRUFBSSxDQUFDLE9BQVEsQ0FBQSxFQUFBLE9BQWdCLENBQUEsRUFBQTtBQUM1QyxLQUFLLG9CQUFDLFFBQVEsRUFBQSxDQUFBLENBQUMsSUFBQSxFQUFJLENBQUMsT0FBUSxDQUFBLEVBQUEsTUFBZSxDQUFBOztJQUVoQyxDQUFBLEVBQUE7QUFDWCxJQUFJLG9CQUFDLFdBQVcsRUFBQSxDQUFBLENBQUMsS0FBQSxFQUFLLENBQUUsQ0FBQyxTQUFTLENBQUMsRUFBQyxDQUFDLEVBQUEsRUFBRSxDQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSyxDQUFBLENBQUcsQ0FBQTs7R0FFbkQsQ0FBQTtJQUNMO0VBQ0Y7QUFDRixDQUFDLENBQUMsQ0FBQzs7QUFFSCxLQUFLLENBQUMsTUFBTSxDQUFDLG9CQUFDLEdBQUcsRUFBQSxJQUFFLENBQUEsQ0FBQyxRQUFRLENBQUMsY0FBYyxDQUFDLFNBQVMsQ0FBQyxDQUFDO0FBQ3ZELEtBQUssQ0FBQyxNQUFNLENBQUMsb0JBQUMsUUFBUSxFQUFBLENBQUEsQ0FBQyxJQUFBLEVBQUksQ0FBRSxLQUFLLENBQUMsSUFBSyxDQUFFLENBQUEsQ0FBQyxRQUFRLENBQUMsY0FBYyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0FBQzNFIiwic291cmNlc0NvbnRlbnQiOlsiXG4vKlxudmFyIGRhdGEgPSB7XG5cdGZyYWN0aW9uICAgIDogNTAsXG5cdG5hdHVyYWxcdFx0OiA1MCxcblx0aXJyYXRpb25hbFx0OiAwLFxuXHR1cFx0OiB7bG93OjEgLGhpZ2g6MTB9LFxuXHRkb3duOiB7bG93OjEgLGhpZ2g6MTB9XG59XG4qL1xudmFyIG1vZGVsID0ge1xuXHR2aWV3X2lkOiAwLFxuXHRkYXRhOiB7XG5cblx0fSxcblx0YWRkcmVzOiBcIlwiLFxuXHR1c2VyOiB7XG5cdFx0bmFtZTogXCJcIixcblx0XHRwYXNzOiBcIlwiXG5cdH0sXG5cdHJlcyA6e1xuXG5cdH1cbn1cblxuZnVuY3Rpb24gY2hlY2tTdG9yYWdlRm9yRGF0YU9yUmV0dXJuRGVmYXVsdChkZWYpe1xuXHRpZihsb2NhbFN0b3JhZ2VbbW9kZWwuYWRkcmVzXSAhPSBudWxsICYmIGxvY2FsU3RvcmFnZVttb2RlbC5hZGRyZXNdICE9IFwiXCIpe1xuXHRcdHJldHVybiBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZVttb2RlbC5hZGRyZXNdKTtcblx0fWVsc2V7XG5cdFx0cmV0dXJuIGRlZlxuXHR9XG59XG5cbi8qKiBAanN4IFJlYWN0LkRPTSAqL1xudmFyIE1hdGhDb21wb25lbnQgPSBSZWFjdC5jcmVhdGVDbGFzcyh7XG5cdGNvbXBvbmVudERpZFVwZGF0ZTpmdW5jdGlvbihwcmV2UHJvcHMsIHByZXZTdGF0ZSl7XG5cblx0XHR2YXIgcHJvYmxlbSA9IHRoaXMucmVmcy5wcm9ibGVtLmdldERPTU5vZGUoKVxuXHRcdHZhciBzb2x1dGlvbiA9IHRoaXMucmVmcy5zb2x1dGlvbi5nZXRET01Ob2RlKClcblx0XHRrYXRleC5yZW5kZXIodGhpcy5wcm9wcy5tYXRoWzBdLnByb2JsZW0scHJvYmxlbSlcblx0XHRrYXRleC5yZW5kZXIodGhpcy5wcm9wcy5tYXRoWzBdLnNvbHV0aW9uLHNvbHV0aW9uKVxuXHRcdFxuXHR9LFxuXHRjb21wb25lbnREaWRNb3VudDogZnVuY3Rpb24oKSB7XG5cdFx0dGhpcy5yZWZzLnByb2JsZW0uZ2V0RE9NTm9kZSgpLmlubmVySFRNTCA9IFwi0JfQsCDQtNCwINGB0YrQt9C00LDQtNC10YLQtSDQt9Cw0LTQsNGH0LAg0L3QsNGC0LjRgdC90LXRgtC1INCz0LXQvdC10YDQuNGA0LDQuVwiXG5cdH0sXG5cdHJlbmRlcjogZnVuY3Rpb24oKXtcblx0XHRyZXR1cm4gKFxuXHRcdFx0PGRpdiBpZD1cIk1hdGhDb250YWluZXJcIj5cblx0XHRcdFx0PHNwYW4gaWQ9XCJyZXN1bHRcIiByZWY9XCJwcm9ibGVtXCI+PC9zcGFuPlxuXHRcdFx0XHQ8c3BhbiBzdHlsZT17e2Rpc3BsYXk6dGhpcy5wcm9wcy5zb2x1dGlvblZpc2FibGUgPyBcImJsb2NrXCIgOiBcIm5vbmVcIn19IHJlZj1cInNvbHV0aW9uXCI+PC9zcGFuPlxuXHRcdFx0PC9kaXY+KVxuXHR9XG59KVxuXG5cbnZhciBJbnB1dENvbXBvbmVudCA9IFJlYWN0LmNyZWF0ZUNsYXNzKHtcblx0dmlld3M6IFtFcXVpdmFsZW50RXhwcmVzc2lvbnMsRXF1YXRpb24sUXVhZHJhdGljRXF1YXRpb25dLFxuXHRnZXRJbml0aWFsU3RhdGU6IGZ1bmN0aW9uKCl7XG5cdFx0cmV0dXJuIHt2aWV3OiBcImRpdlwifVxuXHR9LFxuXHRjb21wb25lbnREaWRNb3VudDogZnVuY3Rpb24oKXtcblx0XHRjb25zb2xlLmxvZyh0aGlzLnZpZXdzKVxuXHRcdHJvdXRpZSgncHJvYmxlbXMvdHlwZS86aWQnLCB0aGlzLmNoYW5nZVZpZXcpO1xuXHR9LFxuXHRjaGFuZ2VWaWV3OiBmdW5jdGlvbihpZCl7XG5cdFx0aWYoaWQgPCB0aGlzLnZpZXdzLmxlbmd0aCl7XG5cdFx0XHR0aGlzLnNldFN0YXRlKHt2aWV3OiB0aGlzLnZpZXdzW2lkXX0pXG5cdFx0XHRtb2RlbC52aWV3X2lkID0gaWQgfCAwO1xuXHRcdH1cblx0fSxcblx0cmVuZGVyOiBmdW5jdGlvbiAoKSB7XG5cdFx0dmFyIGRhdGEgPSB0aGlzLnByb3BzLm1vZGVsLmRhdGFcblx0XHRyZXR1cm4gKFJlYWN0LmNyZWF0ZUVsZW1lbnQodGhpcy5zdGF0ZS52aWV3LHttb2RlbDptb2RlbH0pKTtcblx0fVxufSk7XG5cbnZhciBLYdCiZVhpdGVtID0gUmVhY3QuY3JlYXRlQ2xhc3Moe1xuXHRjb21wb25lbnREaWRNb3VudDogIGZ1bmN0aW9uKCl7XG5cblx0XHQvL2NvbnNvbGUubG9nKHRoaXMucHJvcHMucHJvYmxlbSlcblxuXHRcdHZhciBzaGl0ID0gdGhpcy5yZWZzLnNoaXQuZ2V0RE9NTm9kZSgpXG5cdFx0a2F0ZXgucmVuZGVyKHRoaXMucHJvcHMucHJvYmxlbSxzaGl0KVxuXG5cblx0fSxcblx0Y29tcG9uZW50RGlkVXBkYXRlOiBmdW5jdGlvbihwcmV2UHJvcHMsIHByZXZTdGF0ZSl7XG5cdFx0Ly9jb25zb2xlLmxvZyh0aGlzLnByb3BzLnByb2JsZW0pXG5cblx0XHR2YXIgc2hpdCA9IHRoaXMucmVmcy5zaGl0LmdldERPTU5vZGUoKVxuXHRcdGthdGV4LnJlbmRlcih0aGlzLnByb3BzLnByb2JsZW0sc2hpdClcblx0fSxcblx0cmVuZGVyOiBmdW5jdGlvbigpe1xuXHRcdHJldHVybig8c3BhbiAgcmVmPVwic2hpdFwiPjwvc3Bhbj4pXG5cdH1cbn0pXG5cbnZhciBQcmludExpc3RDb21wb25lbnQgPSBSZWFjdC5jcmVhdGVDbGFzcyh7XG5cdHJlbmRlcjogZnVuY3Rpb24gKCkge1xuXHRcdHByb2JsZW1zID0gdGhpcy5wcm9wcy5yZXMubWFwKGZ1bmN0aW9uKHJlc3VsdCxpdGVyKXtcblx0XHRcdC8vY29uc29sZS5sb2cocmVzdWx0KVxuXHRcdFx0cmV0dXJuICg8ZGl2IGNsYXNzTmFtZT1cIml0ZW1zXCI+PHNwYW4gY2xhc3NOYW1lPVwibnVtXCI+e2l0ZXIrMX08L3NwYW4+PEth0KJlWGl0ZW0gcHJvYmxlbT17cmVzdWx0LnByb2JsZW19IC8+PC9kaXY+KVxuXHRcdH0pXG5cblx0XHRzb2x1dGlvbiA9IHRoaXMucHJvcHMucmVzLm1hcChmdW5jdGlvbihyZXN1bHQsaXRlcil7XG5cdFx0XHQvL2NvbnNvbGUubG9nKHJlc3VsdClcblx0XHRcdHJldHVybiAoPGRpdiBjbGFzc05hbWU9XCJpdGVtc1wiPjxzcGFuIGNsYXNzTmFtZT1cIm51bVwiPntpdGVyKzF9PC9zcGFuPjxLYdCiZVhpdGVtIHByb2JsZW09e3Jlc3VsdC5zb2x1dGlvbn0gLz48L2Rpdj4pXG5cdFx0fSlcblxuXHRcdHJldHVybiAoXG5cblx0XHRcdDxkaXYgaWQ9XCJhbmNob3JcIiBjbGFzc05hbWU9XCJsaXN0XCI+XG5cdFx0XHRcdNCX0LDQtNCw0YfQuDpcblx0XHRcdFx0e3Byb2JsZW1zfVxuXHRcdFx0XHQ8YnIgLz5cblx0XHRcdFx00J7RgtCz0L7QstC+0YDQuDpcblx0XHRcdFx0e3Byb2JsZW1zfVxuXHRcdFx0PC9kaXY+XG5cdFx0KVxuXHR9XG59KTtcblxuXG52YXIgTWVudUxpc3QgPSBSZWFjdC5jcmVhdGVDbGFzcyh7XG5cdGdldEluaXRpYWxTdGF0ZTogZnVuY3Rpb24gKCkge1xuXHRcdHJldHVybiB7XG5cdFx0XHRzZWxlY3RlZDogbW9kZWwudmlld19pZFxuXHRcdH07XG5cdH0sXG5cdGNoYW5nZTogZnVuY3Rpb24oaW5kZXgpe1xuXHRcdGNvbnNvbGUubG9nKGluZGV4KVxuXHRcdHRoaXMuc2V0U3RhdGUoe3NlbGVjdGVkOiBpbmRleH0pXG5cdH0sXG5cdHJlbmRlcjogZnVuY3Rpb24oKXtcblx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cdFx0dmFyIGxpc3QgPSB0aGlzLnByb3BzLml0ZW1zLm1hcChmdW5jdGlvbihpdGVtLGluZGV4KXtcblx0XHRcdHZhciBzdHlsZSA9IFwiXCJcblx0XHRcdGlmKHNlbGYuc3RhdGUuc2VsZWN0ZWQgPT0gaW5kZXgpe1xuXHRcdFx0XHRzdHlsZSA9IFwic2VsZWN0ZWRcIlxuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIDxhIGNsYXNzTmFtZT17c3R5bGV9IGhyZWY9e2l0ZW0uaHJlZn0gb25DbGljaz17c2VsZi5jaGFuZ2UuYmluZChzZWxmLGluZGV4KX0+e2l0ZW0udGV4dH08L2E+XG5cdFx0fSlcblx0XHRyZXR1cm4gKDxkaXY+e2xpc3R9PC9kaXY+KVxuXHR9XG59KSBcblxudmFyIFZpZXdDaGFuZ2VyID0gUmVhY3QuY3JlYXRlQ2xhc3Moe1xuXG5cdHJlbmRlcjogZnVuY3Rpb24gKCkge1xuXHRcdGNvbnNvbGUubG9nKHRoaXMucHJvcHMpXG5cdFx0aWYodGhpcy5wcm9wcy5pZCA8IHRoaXMucHJvcHMudmlld3MubGVuZ3RoKXtcblx0XHRcdHJldHVybiAoUmVhY3QuY3JlYXRlRWxlbWVudCh0aGlzLnByb3BzLnZpZXdzW3RoaXMucHJvcHMuaWRdLHttb2RlbDptb2RlbH0pKTtcblx0XHR9ZWxzZXtcblx0XHRcdHJldHVybiA8ZGl2PjwvZGl2PlxuXHRcdH1cblx0fVxufSk7XG5cblxudmFyIEdlbmVyYXRvciA9IFJlYWN0LmNyZWF0ZUNsYXNzKHtcblx0Z2V0SW5pdGlhbFN0YXRlOiBmdW5jdGlvbigpe1xuXHRcdHJldHVybiB7XG5cdFx0XHRtYXRoOiBbe3Byb2JsZW06IFwiXCIsIHNvbHV0aW9uOiBcIlwifV0sXG5cdFx0XHRzdjogZmFsc2UsXG5cdFx0XHRsaXN0OiBbXVxuXHRcdH1cblx0fSxcblx0c3VibWl0OiBmdW5jdGlvbigpe1xuXHRcdHNlbGYgPSB0aGlzXG5cdFx0bG9jYWxTdG9yYWdlW21vZGVsLmFkZHJlc10gPSBKU09OLnN0cmluZ2lmeShtb2RlbC5kYXRhKVxuXHRcdHN1cGVyYWdlbnQucG9zdChcIi9hcGlcIiArIG1vZGVsLmFkZHJlcykuc2VuZChtb2RlbC5kYXRhKS5zZW5kKHtjb3I6MX0pLmVuZChmdW5jdGlvbihyZXMpe1xuXHRcdFx0aWYocmVzLnN0YXR1cyA9PSAyMDApe1xuXHRcdFx0XHRtb2RlbC5yZXMgPSBKU09OLnBhcnNlKHJlcy50ZXh0KVxuXHRcdFx0XHRzZWxmLnNldFN0YXRlKHttYXRoOiBtb2RlbC5yZXN9KVxuXG5cdFx0XHR9ZWxzZXtcblx0XHRcdFx0c2VsZi5zZXRTdGF0ZSh7bWF0aDoge3Byb2JsZW06IFwiZXJyb3JcIixzb2x1dGlvbjpcIiAtLS0gXCJ9IH0pXG5cblx0XHRcdFx0Ly9rYXRleC5yZW5kZXIoXCJlcnJvclwiLHByb2JsZW0pXG5cblxuXHRcdFx0fVxuXHRcdH0pO1xuXHRcdC8vYWxlcnQobWF0aClcblx0XHQvL2NvbnNvbGUubG9nKG1hdGgpXG5cdFx0XG5cdFx0Ly90aGlzLnNldFN0YXRlKHttYXRoOiBtYXRofSlcblx0fSxcblx0c3VibWl0X21vcmU6IGZ1bmN0aW9uKCl7XG5cdFx0c2VsZiA9IHRoaXNcblx0XHRsb2NhbFN0b3JhZ2VbbW9kZWwuYWRkcmVzXSA9IEpTT04uc3RyaW5naWZ5KG1vZGVsLmRhdGEpXG5cdFx0b2ZzZXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImFuY2hvclwiKS5vZmZzZXRUb3A7XG5cdFx0XG5cdFx0c3VwZXJhZ2VudC5wb3N0KFwiL2FwaVwiICsgbW9kZWwuYWRkcmVzKS5zZW5kKG1vZGVsLmRhdGEpLnNlbmQoe2NvcjoxMH0pLmVuZChmdW5jdGlvbihyZXMpe1xuXHRcdFx0aWYocmVzLnN0YXR1cyA9PSAyMDApe1xuXHRcdFx0XHRtb2RlbC5yZXMgPSBKU09OLnBhcnNlKHJlcy50ZXh0KVxuXHRcdFx0XHRjb25zb2xlLmxvZyhtb2RlbC5yZXMpXG5cblx0XHRcdFx0c2VsZi5zZXRTdGF0ZSh7bGlzdDogbW9kZWwucmVzfSlcblx0XHRcdFx0Y29uc29sZS5sb2cob2ZzZXQpXG5cdFx0XHRcdHNjcm9sbFRvKDAsb2ZzZXQpXG5cblx0XHRcdH1lbHNle1xuXHRcdFx0XHQvL2thdGV4LnJlbmRlcihcImVycm9yXCIscHJvYmxlbSlcblxuXG5cdFx0XHR9XG5cdFx0fSk7XG5cblxuXHRcdC8vYWxlcnQobWF0aClcblx0XHQvL2NvbnNvbGUubG9nKG1hdGgpXG5cdH0sXG5cdHNob3c6IGZ1bmN0aW9uKCl7XG5cdFx0dGhpcy5zZXRTdGF0ZSh7c3Y6ICF0aGlzLnN0YXRlLnN2fSk7XG5cdH0sXG5cdHJlbmRlcjogZnVuY3Rpb24gKCkge1xuXHRcdHJldHVybiAoXG5cdFx0XHQ8ZGl2PlxuXG5cdFx0XHQ8TWF0aENvbXBvbmVudCBtYXRoPXt0aGlzLnN0YXRlLm1hdGh9IHNvbHV0aW9uVmlzYWJsZT17dGhpcy5zdGF0ZS5zdn0vPlxuXG5cdFx0XHQ8ZGl2IGlkPVwic2lkZWJhclwiPlxuXHRcdFx0XHRcdDxkaXYgY2xhc3NOYW1lPVwiaXRlbVwiPlxuXHRcdFx0XHRcdFx0PHNwYW4+NyDQutC70LDRgTwvc3Bhbj5cblx0XHRcdFx0XHRcdDxNZW51TGlzdCBpdGVtcz17W1xuXHRcdFx0XHRcdFx0XHR7aHJlZjogXCIjcHJvYmxlbXMvdHlwZS8wXCIsIHRleHQ6XCJU0YrQttC00LXRgdGC0LLQtdC90Lgg0LjQt9GA0LDQt9C4XCJ9LFxuXHRcdFx0XHRcdFx0XHR7aHJlZjogXCIjcHJvYmxlbXMvdHlwZS8xXCIsIHRleHQ6XCLQo9GA0LDQstC90LXQvdC40Y9cIn1cblx0XHRcdFx0XHRcdFx0XX0gLz5cblx0XHRcdFx0XHQ8L2Rpdj5cblx0XHRcdDwvZGl2PlxuXG5cdFx0XHQ8ZGl2IGlkPVwiaW5uZXItY29udGVudFwiID5cblx0XHRcdFx0XG5cdFx0XHRcdDxkaXY+XG5cdFx0XHRcdFx0PGRpdiBjbGFzc05hbWU9XCJtZW51XCI+XG5cdFx0XHRcdFx0XHQ8ZGl2IGNsYXNzTmFtZT1cIm1lbnUtaXRlbVwiIG9uQ2xpY2s9e3RoaXMuc3VibWl0fT7Qk9C10L3QtdGA0LjRgNCw0Lk8L2Rpdj5cblx0XHRcdFx0XHRcdDxkaXYgY2xhc3NOYW1lPVwibWVudS1pdGVtXCIgb25DbGljaz17dGhpcy5zdWJtaXRfbW9yZX0+0JPQtdC90LXRgNC40YDQsNC5INC90Y/QutC+0LvQutC+PC9kaXY+XG5cdFx0XHRcdFx0XHQ8ZGl2IGNsYXNzTmFtZT1cIm1lbnUtaXRlbVwiIG9uQ2xpY2s9e3RoaXMuc2hvd30+0J/QvtC60LDQttC4L9GB0LrRgNC40Lkg0L7RgtCz0L7QstC+0YDQuNGC0LU8L2Rpdj5cblx0XHRcdFx0XHQ8L2Rpdj5cblx0XHRcdFx0XHRcblx0XHRcdFx0XHQ8ZGl2IGlkPVwiSW5wdXRDb250YWluZXJcIj5cblx0XHRcdFx0XHRcdDxJbnB1dENvbXBvbmVudCBtb2RlbD17bW9kZWx9Lz5cblx0XHRcdFx0XHQ8L2Rpdj5cblxuXHRcdFx0XHRcdDxQcmludExpc3RDb21wb25lbnQgcmVzPXt0aGlzLnN0YXRlLmxpc3R9Lz5cblxuXHRcdFx0XHQ8L2Rpdj5cblx0XHRcdDwvZGl2PlxuXG5cdFx0XHQ8L2Rpdj5cblxuXHRcdCk7XG5cdH1cbn0pO1xuXG52YXIgTWVudSA9IFJlYWN0LmNyZWF0ZUNsYXNzKHtcblx0Z2V0SW5pdGlhbFN0YXRlOiBmdW5jdGlvbigpIHtcblx0XHRyZXR1cm4ge1xuXHRcdFx0dmlzaWJsZTogZmFsc2VcdFxuXHRcdH07XG5cdH0sXG5cblx0c2hvdzogZnVuY3Rpb24oKSB7XG5cdFx0dGhpcy5zZXRTdGF0ZSh7IHZpc2libGU6IHRydWUgfSk7XG5cdFx0ZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMuaGlkZS5iaW5kKHRoaXMpKTtcblx0fSxcblxuXHRoaWRlOiBmdW5jdGlvbigpIHtcblx0XHRkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgdGhpcy5oaWRlLmJpbmQodGhpcykpO1xuXHRcdHRoaXMuc2V0U3RhdGUoeyB2aXNpYmxlOiBmYWxzZSB9KTtcblx0fSxcblxuXHRyZW5kZXI6IGZ1bmN0aW9uKCkge1xuXHRcdHJldHVybiAoXG5cdFx0PGRpdiBjbGFzc05hbWU9XCJcIj5cblx0XHRcdDxkaXYgY2xhc3NOYW1lPXtcInNsaWRlLW1lbnUtXCIrKHRoaXMuc3RhdGUudmlzaWJsZSA/IFwidmlzaWJsZSBcIiA6IFwiXCIpKyBcIiBzbGlkZS1tZW51XCJ9PlxuXHRcdFx0XHR7dGhpcy5wcm9wcy5jaGlsZHJlbn1cblx0XHRcdDwvZGl2PlxuXHRcdDwvZGl2Pik7XG5cdH1cbn0pO1xuXG52YXIgTWVudUl0ZW0gPSBSZWFjdC5jcmVhdGVDbGFzcyh7XG5cdG5hdmlnYXRlOiBmdW5jdGlvbihoYXNoKSB7XG5cdFx0d2luZG93LmxvY2F0aW9uLmhhc2ggPSBoYXNoO1xuXHR9LFxuXG5cdHJlbmRlcjogZnVuY3Rpb24oKSB7XG5cdFx0cmV0dXJuIDxkaXYgY2xhc3NOYW1lPVwic2xpZGUtbWVudS1pdGVtXCIgb25DbGljaz17dGhpcy5uYXZpZ2F0ZS5iaW5kKHRoaXMsIHRoaXMucHJvcHMuaGFzaCl9Pnt0aGlzLnByb3BzLmNoaWxkcmVufTwvZGl2Pjtcblx0fVxufSk7XG5cbnZhciBBcHAgPSBSZWFjdC5jcmVhdGVDbGFzcyh7XG5cdGdldEluaXRpYWxTdGF0ZTogZnVuY3Rpb24oKXtcblx0XHRyZXR1cm4ge1xuXHRcdFx0cGFnZTogMFxuXHRcdH1cblx0fSxcblx0cmVuZGVyOiBmdW5jdGlvbiAoKSB7XG5cdFx0cmV0dXJuIChcblx0XHRcdDxkaXY+XG5cdFx0XHRcdDxNZW51PlxuXHRcdFx0XHRcdDxNZW51SXRlbSBoYXNoPVwiI1dURlwiPkhlbGxvPC9NZW51SXRlbT5cblx0XHRcdFx0XHQ8TWVudUl0ZW0gaGFzaD1cIiNXVEYxXCI+Tm9XYXk8L01lbnVJdGVtPlxuXHRcdFx0XHRcdDxNZW51SXRlbSBoYXNoPVwiI1dURjJcIj5TaGl0PC9NZW51SXRlbT5cblxuXHRcdFx0XHQ8L01lbnU+XG5cdFx0XHRcdDxWaWV3Q2hhbmdlciB2aWV3cz17W0dlbmVyYXRvcl19IGlkPXt0aGlzLnN0YXRlLnBhZ2V9IC8+XG5cblx0XHRcdDwvZGl2PlxuXHRcdCk7XG5cdH1cbn0pO1xuXG5SZWFjdC5yZW5kZXIoPEFwcC8+LGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiY29udGVudFwiKSlcblJlYWN0LnJlbmRlcig8VXNlckZvcm0gZGF0YT17bW9kZWwudXNlcn0vPixkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInVzZXJcIikpXG5cblxuIl19